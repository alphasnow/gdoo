function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){var a="agDropdownCellEditor",i="ag.dropdown.celleditor",o={maxHeight:200},n=27,r=9,l=37,s=38,d=39,c=40,u=13,p=16,f=function(t,i){this.grid=i.grid,this.config=i.config,this.items=i.data.items,this.selected=i.data.selected,this.hook=i.hook,this.arrow=i.arrow||"icon-search",this.name=i.name,this.onSelect=i.select||function(){},this.$input=e(t),this.settings=e.extend({},o,i),this.init(),e.fn[a].instances.push(this)};e.extend(f.prototype,{init:function(){this._construct(),this._events()},_construct:function(){this.$container=e('<div class="combo-select combo-open combo-'+this.name+'" />'),this.$arrow=e('<div class="combo-arrow"><i class="fa '+this.arrow+'"></i></div>'),this.$dropdown=e('<ul class="combo-dropdown" />').appendTo(this.$container),this._build(),this.$input.after(this.$arrow),e("body").append(this.$container);var t=this.$input.outerHeight(),a=this.$input.outerWidth(),i=this.$input.offset();this.$container.css({width:a+2,left:i.left-1,top:i.top+t+1})},_build:function(){var t=this,a="",i=0;a+='<li class="option-item-empty">无匹配选项</li>',e.each(this.items,(function(e,o){if("optgroup"==o)return a+='<li class="option-group">'+this.label+"</li>";a+='<li class="'+(this.disabled?"option-disabled":"option-item")+" "+(this.id==t.selected?"option-selected":"")+'" data-index="'+i+'" data-value="'+this.id+'">'+this.name+"<i>"+this.code+"</i></li>",i++})),this.$dropdown.html(a),this.$items=this.$dropdown.children()},_events:function(){this.$arrow.off(),this.$container.off(),this.$input.off(),this.$arrow.on("click.arrow",e.proxy(this._toggle,this)),this.$container.on("dropdown:close",e.proxy(this._close,this)),this.$container.on("dropdown:open",e.proxy(this._open,this)),this.$container.on("dropdown:update",e.proxy(this._update,this)),this.$input.on("keydown",e.proxy(this._keydown,this)),this.$input.on("keyup",e.proxy(this._keyup,this)),this.$container.on("click.item",".option-item",e.proxy(this._select,this))},_keydown:function(e){switch(e.which){case n:this.$container.trigger("dropdown:close");break;case s:this._move("up",e),e.stopPropagation();break;case c:this._move("down",e),e.stopPropagation();break;case r:this._enter(e);break;case d:break;case u:this._enter(e)}},_keyup:function(e){switch(e.which){case n:case u:case s:case c:case l:case d:case r:case p:break;default:this._filter(e.target.value)}},_enter:function(e){var t=this._getHovered();this._select(t)},_move:function(e,t){var a=this._getVisible(),i=this._getHovered().prevAll(".option-item").filter(":visible").length,o=a.length;switch(e){case"up":--i<0&&(i=o-1);break;case"down":++i>=o&&(i=0)}a.removeClass("option-hover").eq(i).addClass("option-hover"),this.opened||this.$container.trigger("dropdown:open"),this._fixScroll()},_select:function(t){var a=(t.currentTarget?e(t.currentTarget):e(t)).data("index");this._selectByIndex(a),this.$container.trigger("dropdown:close")},_selectByIndex:function(t){void 0===t&&(t=-1),this._getAll().removeClass("option-selected").filter((function(){return e(this).data("index")==t})).addClass("option-selected"),this._change()},_autofill:function(){var e=this._getHovered();if(e.length){var t=e.data("index");this._selectByIndex(t)}},_filter:function(t){var a=this._getAll(),i=e.trim(t).toLowerCase(),o=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g"),n="("+t.replace(o,"\\$1")+")";e(".combo-marker",a).contents().unwrap(),i?(this.$items.filter(".option-group, .option-disabled").hide(),a.hide().filter((function(){var t=e(this);if(-1!=e.trim(t.text()).toLowerCase().toString().indexOf(i))return t.html((function(e,t){return t.replace(new RegExp(n,"gi"),'<span class="combo-marker">$1</span>')})),!0})).show()):a.show(),this.$container.trigger("dropdown:open"),0==this._getVisible().length?this.$items.filter(".option-item-empty").show():this.$items.filter(".option-item-empty").hide()},_highlight:function(){var e=this._getVisible().removeClass("option-hover"),t=e.filter(".option-selected");t.length?t.addClass("option-hover"):e.removeClass("option-hover").first().addClass("option-hover")},_updateInput:function(){var e=this._getAll().filter(".option-selected").data("index");this.onSelect.call(this,this.items[e])},_focus:function(e){this.$container.toggleClass("combo-focus",!this.opened),this.opened||this.$container.trigger("dropdown:open")},_change:function(){this._updateInput()},_getAll:function(){return this.$items.filter(".option-item")},_getVisible:function(){return this.$items.filter(".option-item").filter(":visible")},_getHovered:function(){return this._getVisible().filter(".option-hover")},_open:function(){var t=this;this.$container.addClass("combo-open"),this.$arrow.addClass("combo-arrow-open"),this.opened=!0,this._highlight(),this._fixScroll(),e.each(e.fn[a].instances,(function(e,a){a!=t&&a.opened&&a.$container.trigger("dropdown:close")}))},_toggle:function(e){this.opened?this._close.call(this):this._open.call(this),this.$input.focus(),e.stopPropagation()},_close:function(){this.$container.removeClass("combo-open combo-focus"),this.$arrow.removeClass("combo-arrow-open"),this.$container.trigger("dropdown:closed"),this.opened=!1,this.$items.filter(".option-item").show()},_fixScroll:function(){if(!this.$dropdown.is(":hidden")){var e=this._getHovered();if(e.length){var t,a,i,o=e.outerHeight();t=e[0].offsetTop,i=(a=this.$dropdown.scrollTop())+this.settings.maxHeight-o,t<a?this.$dropdown.scrollTop(t):t>i&&this.$dropdown.scrollTop(t-this.settings.maxHeight+o)}}},_update:function(){this.$dropdown.empty(),this._build()},dispose:function(){this.$arrow.remove(),this.$input.remove(),this.$dropdown.remove()}}),e.fn[a]=function(t,a){return this.each((function(){var o=e(this).data("plugin_"+i);"string"==typeof t?o&&"function"==typeof o[t]&&o[t](a):(o&&o.dispose&&o.dispose(),e.data(this,"plugin_"+i,new f(this,t)))})),this},e.fn[a].instances=[]}(jQuery),function(e){var t,a=null;function i(t,a){var i=e("#gdoo-gird-suggest");i.is(":visible")&&(i.hide(),t.trigger("onHideDropdown",[a?a.data:[]]))}function o(t,i,o){return function(t,a){var i=e("#gdoo-gird-suggest");i.is(":visible")||(i.show(),t.trigger("onShowDropdown",[a?a.data:[]]))}(t,o),a.remoteParams.q=t.val(),a.remoteData(),t}function n(t,a,i,o){return i=e.trim(i),o.ignorecase&&(t=t.toLocaleLowerCase(),i=i.toLocaleLowerCase()),i&&(function(t,a){var i=a.effectiveFields;return!("__index"===t||i.length&&!~e.inArray(t,i))}(a,o)||function(t,a){return~e.inArray(t,a.searchFields)}(a,o))&&(~i.indexOf(t)||o.twoWayMatch&&~t.indexOf(i))}var r={query:{},item:{},data:[],allowNoKeyword:!0,ignorecase:!1,searchFields:[],twoWayMatch:!0,delay:300,showBtn:!0,clearable:!1,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13,fnGetData:function(e,t,a,i){var o,r,l,s,d=[];if(e=e||"",i.url)a(t,i.data,i);else{if(o=i.data)if(e){for(s=o.length,r=0;r<s;r++)for(l in o[r])if(o[r][l]&&n(e,l,o[r][l]+"",i)){d.push(o[r]),d[d.length-1].__index=r;break}}else d=o;a(t,d,i)}}},l={init:function(n){return n=n||{},n=e.extend(!0,{},r,n),this.each((function(){var r,l,s=e(this),d=s.parent(),c=function(t,a){var i=t.prev("i.clearable");return a.clearable&&!i.length&&(i=e('<i class="clearable glyphicon glyphicon-remove"></i>').prependTo(t.parent())),i.css({position:"absolute",top:12,zIndex:4,cursor:"pointer",fontSize:12}).hide()}(s,n),u=e("#gdoo-gird-suggest");0===u.length&&(u=e('<div class="gdoo-gird-suggest" id="gdoo-gird-suggest" style="position:absolute;display:none;box-shadow:0 2px 5px 0 rgb(0 0 0 / 26%);"></div>'),e("body").append(u)),function(t,o){var n=o.query;n.suggest=!0,e("#gdoo-gird-suggest").html('<div style="height:180px;overflow:auto;width:auto;"><div id="suggest-'+n.id+'" class="ag-theme-balham" style="width:100%;height:180px;border-left:1px solid #BDC3C7;border-right:1px solid #BDC3C7;"></div></div>');var r=gdoo.formKey(n),l=gdoo.event.get(r.key);l.trigger("query",n),l.trigger("open",n),n.prefix;var s=document.querySelector("#suggest-"+n.id);a=new agGridOptions;var d=0!=n.multi;a.remoteDataUrl=app.url(n.url),a.remoteParams=n,a.rowSelection=d?"multiple":"single",a.suppressRowClickSelection=!0,a.columnDefs=[{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"code",headerName:"存货编码",width:100},{suppressMenu:!0,cellClass:"text-left",sortable:!0,field:"name",headerName:"产品名称",minWidth:140},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"spec",headerName:"规格型号",width:100},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"barcode",headerName:"产品条码",width:120},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"unit_id_name",headerName:"计量单位",width:80},{suppressMenu:!0,cellClass:"text-right",field:"price",headerName:"价格",width:80}],a.onRowClicked=function(e){a.dialogSelected(e.data)&&i(t,o)},a.dialogSelected=function(e){var a=!0,i=gdoo.forms[n.form_id],r=i.links[n.id],s=o.item;for(key in 0==query.grid_id&&(query.grid_id=i.lastEditCell.data.id),r)s[key]=e[r[key]];return l.exist("onSelect")&&(a=l.trigger("onSelect",s,e)),i.lastEditCell.data=s,i.api.memoryStore.update(s),t.trigger("onSelect",[s]),i.generatePinnedBottomData(),a},new agGrid.Grid(s,a)}(s,n),s.off(),n.showBtn||(s.css("borderRadius",4),d.css("width","100%").find(".btn:eq(0)").hide()),s.removeClass("disabled").prop("disabled",!1).attr("autocomplete","off"),s.on("keydown",(function(e){u.is(":visible")&&e.keyCode===n.keyEnter&&i(s,n)})).on("compositionstart",(function(e){t=!0})).on("compositionend",(function(e){t=!1})).on("keyup input paste",(function(a){var i;~e.inArray(a.keyCode,[n.keyDown,n.keyUp,n.keyEnter])?s.val(s.val()):(clearTimeout(l),l=setTimeout((function(){t||(i=s.val(),e.trim(i)&&i===function(e,t){return void 0!==t?e.attr("alt",t):e.attr("alt")}(s)||(i.length||n.allowNoKeyword)&&n.fnGetData(e.trim(i),s,o,n))}),n.delay||300))})).on("blur",(function(){r||i(s,n)})).on("focus",(function(){u.off();var t=e(window).width(),a=e(window).height(),i=s.outerWidth(),o=s.outerHeight(),n=s.offset(),l=u.outerWidth(),d=u.outerHeight(),c={top:n.top+o};t<768?(c.minWidth=360,c.left=14,c.right=14):(c.left=n.left-1,t<n.left+l+10&&(c.left=n.left-l+i+1),a<n.top+d+10&&(c.top=n.top-d)),u.css(c),u.on("mouseenter",(function(){r=1,s.blur()})).on("mouseleave",(function(){r=0,s.focus()})).on("click",(function(){return!1}))})),c.length&&(c.click((function(){})),d.mouseenter((function(){s.prop("disabled")||c.css("right",n.showBtn?Math.max(s.next(".input-group-btn").width(),33)+2:12).show()})).mouseleave((function(){c.hide()})))}))},show:function(){return this.each((function(){e(this).click()}))},hide:function(){return this.each((function(){i(e(this))}))},disable:function(){return this.each((function(){e(this).attr("disabled",!0).parent().find(".btn:eq(0)").prop("disabled",!0)}))},enable:function(){return this.each((function(){e(this).attr("disabled",!1).parent().find(".btn:eq(0)").prop("disabled",!1)}))},destroy:function(){return this.each((function(){e(this).off().removeData("gdooSuggest").removeAttr("style").parent().find(".btn:eq(0)").off().show().attr("data-toggle","dropdown").prop("disabled",!1).next().css("display","").off()}))}};e.fn.gdooSuggest=function(t){if("string"==typeof t&&l[t]){var a=!0;return this.each((function(){if(!e(this).data("gdooSuggest"))return a=!1})),a||"init"===t||"version"===t?l[t].apply(this,[].slice.call(arguments,1)):this}return l.init.apply(this,arguments)}}(jQuery);var formGridList={};function gridForms(e,t,a){a.master=e;var i=gridForm(t,a);return formGridList[e].push(i),i}function gridForm(e,t){t=$.extend({heightTop:70,data:[],dataType:"local"},t);var a=new agGridOptions;a.suppressLoadingOverlay=!0,a.suppressNoRowsOverlay=!0,a.rowMultiSelectWithClick=!1,a.singleClickEdit=!0,a.rowSelection="single",a.suppressCellSelection=!1,a.suppressRowClickSelection=!1,a.columnDefs=t.columns,a.links=t.links,a.tableTitle=t.title,a.tableKey=t.table,a.tableSaveDataNotEmpty=t.saveDataNotEmpty,a.defaultColDef.sortable=!1,a.defaultColDef.filter=!1,a.defaultColDef.suppressMenu=!0,a.defaultColDef.suppressNavigable=!0,a.isEditing=!1,a.isEditingDialog=!1;var i=gdoo.event.get("grid."+e),o=i.args.editable||{};a.defaultColDef.editable=function(e){if(e.node.rowPinned)return!1;var t=e.colDef,i=o[t.field];return"function"==typeof i?i.call(a,e):!!e.colDef._editable},a.getRowNodeId=function(e){if(e.id)return e.id},a.onRowClicked=function(e){},a.stopEditingWhenGridLosesFocus=!1,a.onRowDoubleClicked=function(e){},a.onCellEditingStarted=function(e){a.lastEditCell=e,a.isEditingDialog="dialogCellEditor"==e.colDef.cellEditor,a.isEditing=!0},a.onCellEditingStopped=function(){a.isEditing=!1,a.isEditingDialog&&$("#gdoo-gird-suggest").hide()};var n=!1,r=document.querySelector("#grid_"+e);""==r.style.height&&(n=!0,r.style.height=s()+"px"),i.trigger("init",a),new agGrid.Grid(r,a),a.api.dialogSelected=function(e,i){var o=gdoo.event.get(e.form_id+"."+e.id),n=t.links[e.id],r=a.api.memoryStore,l=[];a.api.forEachNode((function(t,a){null==t.data[e.id]&&l.push(t.data)})),0==e.grid_id&&(e.grid_id=a.lastEditCell.data.id);for(var s=0;s<i.length;s++){var d=l[s],c=!0;if(null==d&&(d={},c=!1),1==i.length){var u=a.api.getSelectedRows();if(0==u.length){if(d={},e.grid_id)d=a.api.getRowNode(e.grid_id).data,c=!0}else e.grid_id&&(d=u[0],c=!0)}var p=i[s];for(key in n)d[key]=p[n[key]];o.trigger("onSelect",d,p),c?r.update(d):r.create(d),1==i.length&&e.grid_id&&$("#"+e.name+"_"+e.grid_id).val(d[e.name])}a.generatePinnedBottomData()},a.api.memoryStore={lastIndex:1,created:[],updated:[],deleted:[],create:function(e,t){this.lastIndex++,e.id="draft_"+this.lastIndex,e=a.calcRow(e),this.created.push(e),a.api.updateRowData({add:[e],addIndex:t})},update:function(e){e=a.calcRow(e),this.updated.push(e),a.api.updateRowData({update:[e]})},delete:function(e,t){0==t&&this.deleted.push(e),this.created=this.created.filter((function(t){return t.id!=e.id})),this.updated=this.updated.filter((function(t){return t.id!=e.id}));a.api.updateRowData({remove:[e]});a.generatePinnedBottomData()}},a.onFirstDataRendered=function(e){this.api;this.generatePinnedBottomData()},a.calcRow=function(e,a){for(var i=0;i<t.columns.length;i++){var o=t.columns[i];if(o.calcRow){var n=new Function("data","column",o.calcRow),r=parseFloat(n(e,a||{}));(isNaN(r)||0===r)&&(r=""),e[o.field]=r}}return e},a.onCellValueChanged=function(e){var t=this;if(e.oldValue!=e.newValue){var a=e.data;a=t.calcRow(a,e.column),t.api.updateRowData({update:[a]}),t.generatePinnedBottomData()}},"local"==t.dataType&&(t.data.length>0?("function"==typeof i.dataLoaded&&i.dataLoaded.call(a,t.data),a.api.updateRowData({add:t.data})):a.api.memoryStore.create({})),a.api.deleteRow=function(e){var t=a.api.getRowNode(e.id).data;0===(""+t.id).indexOf("draft_")?a.api.memoryStore.delete(t,!0):a.api.memoryStore.delete(t,!1)};var l=$(r);function s(){var e=$("#tab-content-"+t.master).position(),a=$(window).height()-e.top-t.heightTop;return a>320?a:320}return l.off(),l.on("click",'[data-toggle="event"]',(function(){var e=$(this).data();"option"==e.action&&("add"==e.type?a.api.memoryStore.create({}):a.api.getDisplayedRowCount()>1&&a.api.deleteRow(e))})),l.on("blur",".ag-input-wrapper",(function(){a.isEditingDialog||a.isEditing&&a.api.stopEditing()})),a.onGridReady=function(e){i.trigger("ready",a),n&&window.addEventListener("resize",(function(){setTimeout((function(){r.style.height=s()+"px"}))}))},gdoo.forms[e]=a,a}function getPanelHeight(e){return"calc(100vh - "+($(".gdoo-list-grid").position().top+e+"px")+")"}!function(e,t){var a={page:"页",more:"更多",to:"到",of:"至",next:"下一页",last:"上一页",first:"首页",previous:"上一页",loadingOoo:"加载中...",selectAll:"查询全部",searchOoo:"查询...",blanks:"空白",filterOoo:"过滤...",applyFilter:"daApplyFilter...",equals:"相等",notEqual:"不相等",lessThan:"小于",greaterThan:"大于",lessThanOrEqual:"小于等于",greaterThanOrEqual:"大于等于",inRange:"范围",contains:"包含",notContains:"不包含",startsWith:"开始于",endsWith:"结束于",group:"组",columns:"列",filters:"筛选",rowGroupColumns:"laPivot Cols",rowGroupColumnsEmptyMessage:"la drag cols to group",valueColumns:"laValue Cols",pivotMode:"laPivot-Mode",groups:"laGroups",values:"值",pivots:"laPivots",valueColumnsEmptyMessage:"la drag cols to aggregate",pivotColumnsEmptyMessage:"la drag here to pivot",toolPanelButton:"la tool panel",noRowsToShow:"数据为空",pinColumn:"laPin Column",groupBy:"排序",ungroupBy:"不排序",resetColumns:"重置列",expandAll:"展开全部",collapseAll:"关闭",toolPanel:"工具面板",export:"导出",csvExport:"导出为CSV格式文件",excelExport:"导出到Excel",sum:"总数",min:"最小值",max:"最大值",none:"无",count:"总",average:"平均值",copy:"复制",copyWithHeaders:"携带表头复制",ctrlC:"ctrl + C",paste:"粘贴",ctrlV:"ctrl + V"};function i(){}function o(){}function n(){}function r(){}function l(){}function s(){}function d(){}function c(){}i.prototype.init=function(e){e.node.rowPinned||(this.eGui=document.createElement("div"),this.eGui.className="options",this.eGui.innerHTML='<a data-toggle="event" data-action="option" data-type="add" data-index="'+e.rowIndex+'" data-id="'+e.data.id+'" class="fa fa-plus" title="新增行"></a>  <a data-toggle="event" data-action="option" data-type="delete" data-id="'+e.data.id+'" data-index="'+e.rowIndex+'" class="fa fa-times" title="删除行"></a></div>')},i.prototype.getGui=function(){return this.eGui},o.prototype.init=function(e){this.eGui=document.createElement("span"),this.eGui.innerHTML=e.value||""},o.prototype.getGui=function(){return this.eGui},n.prototype.init=function(e){var t=e.api.gridCore.gridOptions;if(!e.node.rowPinned&&null!=e.data){var a=e.data,i="";a.master_id>0&&e.colDef.options.forEach((function(e){if(e.display){var o='<a data-toggle="event" class="option" data-action="'+e.action+'" data-master_name="'+a.name+'"  data-master_id="'+a.master_id+'" href="javascript:;">'+e.name+"</a>";i+=t.actionCellBeforeRender(o,e,a)||""}})),this.eGui=document.createElement("span"),this.eGui.innerHTML=i}},n.prototype.getGui=function(){return this.eGui},r.prototype.init=function(e){this.grid=e,this.selectedKey=null,this.items=e.colDef.cellEditorParams.values,this.eInput=document.createElement("input"),this.eInput.value=e.value||"",this.eInput.className="ag-cell-edit-input form-control"},r.prototype.getGui=function(e){return this.eInput},r.prototype.afterGuiAttached=function(){var e=this,a=e.grid,i=e.eInput.value;t(e.eInput).agDropdownCellEditor({grid:e,arrow:"fa-caret-down",data:{items:e.items,selected:a.data[a.select_key]},select:function(t){t?(a.data[a.select_key]=t.id,e.eInput.value=t.name,e.selectedKey=t.id):e.eInput.value=i,a.stopEditing()}}),e.eInput.focus(),e.eInput.select()},r.prototype.getValue=function(){return this.eInput.value},r.prototype.destroy=function(){t("body").find(".combo-select").remove()},l.prototype.init=function(e){var t=e.value,a=e.colDef.cellEditorParams.values;this.eGui=document.createElement("div"),this.eGui.innerHTML=a[t]||a[0]},l.prototype.getGui=function(){return this.eGui},s.prototype.init=function(e){var t=e.value;this.eInput=document.createElement("input"),this.eInput.type="checkbox",this.eInput.checked=t,this.eInput.value=t},s.prototype.getGui=function(e){return this.eInput},s.prototype.afterGuiAttached=function(){this.eInput.focus(),this.eInput.select()},s.prototype.getValue=function(){return this.eInput.checked?1:0},s.prototype.destroy=function(){},d.prototype.init=function(e){this.params=e,this.eInput=document.createElement("div"),this.eInput.tabIndex="-1";var a=e.colDef.field+"_"+e.data.id,i=e.query;i.multi=1,i.is_grid=1,i.url=e.url,i.grid_id=e.data.id,i.title=e.title;var o="";t.each(i,(function(e,t){o+=" data-"+e+'="'+t+'"'})),this.query=i,this.eInput.innerHTML='<input class="ag-cell-edit-input" value="'+(e.value||"")+'" id="'+a+'"><a class="combo-arrow" data-toggle="dialog-view" '+o+'><i class="fa fa-search"></i></a>',this.eInput.className="ag-input-wrapper ag-input-dialog-wrapper"},d.prototype.getGui=function(e){return this.eInput},d.prototype.afterGuiAttached=function(){var e=this;t(e.eInput).find("input").gdooSuggest({item:e.params.data,query:e.query}).on("onSelect",(function(t,a){e.params.data[e.query.name]=a[e.query.name],e.eInput.querySelector("input").value=a[e.query.name]})),e.eInput.querySelector("input").select()},d.prototype.getValue=function(){return this.params.data[this.params.query.name]},d.prototype.destroy=function(){t(this.eInput).find("input").off()},d.prototype.isPopup=function(){return!1},c.prototype.init=function(e){this.params=e.colDef.cellEditorParams,this.eInput=document.createElement("div"),this.eInput.innerHTML='<input type="text" class="ag-cell-edit-input" data-toggle="date" value="'+(e.value||"")+'">',this.eInput.className="ag-input-wrapper ag-input-date-wrapper"},c.prototype.getGui=function(e){return this.eInput},c.prototype.afterGuiAttached=function(){this.eInput.querySelector("input").click()},c.prototype.getValue=function(){return this.eInput.querySelector("input").value},c.prototype.destroy=function(){},e.agGridOptions=function(){var e={defaultColDef:{minWidth:100,enableRowGroup:!0,enablePivot:!0,enableValue:!0,sortable:!0,resizable:!0,filter:!0,comparator:function(e,t){return"htmlCellRenderer"==this.cellRenderer?(e=delHtmlTag(e),t=delHtmlTag(t),e.localeCompare(t)):"string"==typeof e?e.localeCompare(t):e>t?1:e<t?-1:0}},pinnedBottomRowData:[],rowDragManaged:!0,suppressRowClickSelection:!0,rowMultiSelectWithClick:!1,rowSelection:"multiple",localeText:a,suppressAnimationFrame:!0,suppressContextMenu:!0,suppressPropertyNamesCheck:!0,suppressCellSelection:!0,enableCellTextSelection:!0,remoteDataUrl:"",remoteParams:{},dialogList:{},editableList:{},autoColumnsToFit:!0,lastEditCell:{},selectedRows:[],pager:!1,pagerDom:null,pagePer:50,numberEmptyDefaultValue:!1,pageList:[50,100,500,1e3,2e3,5e3,1e4,2e4,5e4],onCellEditingStarted:function(e){this.lastEditCell=e},remoteBeforeSuccess:function(){},remoteAfterSuccess:function(){},onGridSizeChanged:function(){},onGridReady:function(){},onFirstDataRendered:function(e){var t=this,a=t.api;t.autoColumnsToFit&&a.sizeColumnsToFit(),"function"==typeof t.onCustomFirstDataRendered&&t.onCustomFirstDataRendered.call(t,e),t.generatePinnedBottomData()},onCellValueChanged:function(e){this.generatePinnedBottomData()},getRowStyle:function(e){},onRowClicked:function(e){!1===e.node.isSelected()&&e.node.setSelected(!0,!0)},getSelectedRows:function(){return this.selectedRows},onRowSelected:function(e){var t=this,a=e.node;if(a.selected)t.selectedRows.push(a.data);else for(var i=0;i<t.selectedRows.length;i++){var o=t.selectedRows[i];a.data.id==o.id&&t.selectedRows.splice(i,1)}},columnTypes:{number:{cellClass:"ag-cell-number",valueFormatter:function(t){if(t.node.rowPinned&&!t.colDef.calcFooter)return"";var a=t.colDef.numberOptions||{},i=null==a.places?2:a.places,o=null==a.separator?".":a.separator,n=null==a.thousands?",":a.thousands,r=null==a.default?0:a.default,l=parseFloat(t.value);return isNaN(l)||0==l?0==e.numberEmptyDefaultValue?r:"":l=number_format(l,i,o,n)},valueParser:function(e){var t=parseFloat(e.newValue);return isNaN(t)?0:t}},sn:{cellClass:"ag-cell-sn",valueFormatter:function(e){return e.node.rowPinned?"":parseInt(e.node.childIndex)+1},valueParser:function(e){return parseFloat(e.newValue)}},datetime:{cellClass:"ag-cell-datetime",valueFormatter:function(e){return e.node.rowPinned?"":format_datetime(e.value)},valueParser:function(e){return parseFloat(e.newValue)}},date:{cellClass:"ag-cell-date",valueFormatter:function(e){return e.node.rowPinned?"":format_date(e.value)},valueParser:function(e){return parseFloat(e.newValue)}}},components:{optionCellRenderer:i,actionCellRenderer:n,htmlCellRenderer:o,selectCellEditor:r,dialogCellEditor:d,dateCellEditor:c,checkboxCellEditor:s,checkboxCellRenderer:l},overlayLoadingTemplate:'<span class="ag-overlay-loading-center">数据加载中...</span>',overlayNoRowsTemplate:'<div style="padding-top:20px;"><img alt="暂无数据" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAxKSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgIDxlbGxpcHNlIGZpbGw9IiNGNUY1RjUiIGN4PSIzMiIgY3k9IjMzIiByeD0iMzIiIHJ5PSI3Ii8+CiAgICA8ZyBmaWxsLXJ1bGU9Im5vbnplcm8iIHN0cm9rZT0iI0Q5RDlEOSI+CiAgICAgIDxwYXRoIGQ9Ik01NSAxMi43Nkw0NC44NTQgMS4yNThDNDQuMzY3LjQ3NCA0My42NTYgMCA0Mi45MDcgMEgyMS4wOTNjLS43NDkgMC0xLjQ2LjQ3NC0xLjk0NyAxLjI1N0w5IDEyLjc2MVYyMmg0NnYtOS4yNHoiLz4KICAgICAgPHBhdGggZD0iTTQxLjYxMyAxNS45MzFjMC0xLjYwNS45OTQtMi45MyAyLjIyNy0yLjkzMUg1NXYxOC4xMzdDNTUgMzMuMjYgNTMuNjggMzUgNTIuMDUgMzVoLTQwLjFDMTAuMzIgMzUgOSAzMy4yNTkgOSAzMS4xMzdWMTNoMTEuMTZjMS4yMzMgMCAyLjIyNyAxLjMyMyAyLjIyNyAyLjkyOHYuMDIyYzAgMS42MDUgMS4wMDUgMi45MDEgMi4yMzcgMi45MDFoMTQuNzUyYzEuMjMyIDAgMi4yMzctMS4zMDggMi4yMzctMi45MTN2LS4wMDd6IiBmaWxsPSIjRkFGQUZBIi8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"><div style="padding-top:5px;color:#999;">暂无数据</div></div>',generatePinnedBottomData:function(){var t=this,a={},i=!1;e.columnApi.getAllGridColumns().forEach((function(e){e.colDef.calcFooter&&(i=!0,a[e.colId]=t.calculatePinnedBottomData(e))})),i&&t.api.setPinnedBottomRowData([a])},calculatePinnedBottomData:function(t){var a=0;return e.api.forEachNode((function(e){a+=toNumber(e.data[t.colId])})),0==a?"":a},actionCellBeforeRender:function(e,t,a){return e},remoteData:function(a,i){var o=this,n=e.remoteParams;for(var r in a)n[r]=a[r];e.api.showLoadingOverlay(),t.post(e.remoteDataUrl,n,(function(a){if(e.remoteBeforeSuccess.call(e,a),"function"==typeof i&&i(a),a.per_page)if(null===o.pagerDom){var n=o.api.gridCore.eGridDiv,r=n.id+"-pager";t(n).after('<div id="'+r+'" class="ag-pager"></div>'),o.pagerDom=t("#"+r).Paging({pagesize:a.per_page,count:a.total,current:a.current_page,pageSizeList:[50,100,500,1e3,2e3,5e3,1e4,2e4,5e4],callback:function(e,t,a){o.remoteData2({page:e,limit:t})}})}else o.pagerDom[0].render({pagesize:a.per_page,count:a.total,current:a.current_page});e.api.hideOverlay(),e.api.setRowData(a.data),e.generatePinnedBottomData(),e.remoteAfterSuccess.call(e,a)}),"json")},remoteData2:function(a,i){var o=e.remoteParams;for(var n in a)o[n]=a[n];e.api.showLoadingOverlay(),t.post(e.remoteDataUrl,o,(function(t){e.remoteBeforeSuccess.call(e,t),"function"==typeof i&&i(t),e.api.hideOverlay(),e.api.setRowData(t.data),e.generatePinnedBottomData(),e.remoteAfterSuccess.call(e,t)}),"json")}};return e}}(window,jQuery),function(e){var t=function(e){var t=this;t.args=e,t.trigger=function(e){if("function"==typeof t.args[e]){for(var a=[],i=1;i<arguments.length;i++)a.push(arguments[i]);return t.args[e].apply(t,a)}},t.exist=function(e){return"function"==typeof t.args[e]}},a={formKey:function(e){if(e.form_id)var t=e.form_id+"."+e.id,a=e.form_id+"_"+e.id,i=e.form_id+"_"+e.name;else t=e.id,a=e.id,i=e.name;return{id:a,key:t,name:i}},widgets:{},forms:{},dialogs:{},grids:{},event:{events:{},set:function(e,a){this.events[e]=new t(a)},get:function(e){return this.events[e]||new t({})}},dialogInit:function(t,i){var o=a.formKey(t),n=a.event.get(o.key);n.trigger("query",t);var r=!0;document.onkeydown=function(e){17==(e=e||window.event).keyCode&&(r=!1)},document.onkeyup=function(e){17==(e=e||window.event).keyCode&&(r=!0)};var l=0!=t.multi;return i.suppressRowClickSelection=!0,i.rowSelection=l?"multiple":"single",i.multiple=l,i.onRowClicked=function(e){var t=e.node.isSelected();l?(!1===t&&e.node.setSelected(!0,r),!0===t&&!1===r&&e.node.setSelected(!1,!1)):!1===t&&e.node.setSelected(!0,!0)},i.onRowSelected=function(e){if(t.is_grid);else{var a=1==t.prefix?"sid":"id",i=dialogCacheSelected[o.id];e.node.isSelected()?i[e.data[a]]=e.data.name:delete i[e.data[a]],dialogCacheSelected[o.id]=i}},i.onRowDoubleClicked=function(){1==a.dialogSelected(n,t,o,i)&&e("#gdoo-dialog-"+t.dialog_index).dialog("close")},i.remoteAfterSuccess=function(){a.dialogInitSelected(t,o,i)},a.dialogs[o.id]=i,o},dialogSelected:function(t,i,o,n){var r=n.api.getSelectedRows();if(i.is_grid){a.forms[i.form_id].api.dialogSelected(i,r)}else{var l=1==i.prefix?"sid":"id",s=0!=i.multi,d=getIframeDocument(i.iframe_id);if(d)var c=e("#"+o.id,d),u=e("#"+o.id+"_text",d);else c=e("#"+o.id),u=e("#"+o.id+"_text");var p=dialogCacheSelected[o.id]||{};if(e.each(r,(function(e,t){p[t[l]]=t.name})),c.val(Object.keys(p).join(",")),u.val(Object.values(p).join(",")),t.exist("onSelect"))return t.trigger("onSelect",s?r:r[0])}return!0},dialogInitSelected:function(t,a,i){if(t.is_grid);else{var o=1==t.prefix?"sid":"id",n=getIframeDocument(t.iframe_id);if(n)var r=e("#"+a.id,n),l=e("#"+a.id+"_text",n);else r=e("#"+a.id),l=e("#"+a.id+"_text");if(t.is_org)var s=dialogCacheSelected[a.id];else{var d=r.val(),c=l.val();s={};if(d)for(var u=d.split(","),p=c.split(","),f=0;f<u.length;f++)s[u[f]]=p[f];dialogCacheSelected[a.id]=s}i.api.forEachNode((function(e){var t=e.data[o];null!=s[t]&&e.setSelected(!0)}))}},grid:function(t){var i=this;this.table=t,this.grid=new agGridOptions,this.header=Vue.reactive({init:!1,name:"",master_table:"",access:{},create_btn:!1,trash_btn:!1,simple_search_form:!0,right_buttons:[],left_buttons:[],buttons:[],tabs:{items:[],active:""},search_form:{columns:[]},bys:{name:"全部",items:[]}}),this.search={simple:{el:null,query:{}},advanced:{el:null,query:{}}},this.action=new gridAction,this.grid.autoColumnsToFit=!1,this.grid.onRowDoubleClicked=function(e){e.node.rowPinned||null!=e.data&&e.data.master_id>0&&i.action.rowDoubleClick&&i.action.rowDoubleClick(e.data)},this.div=function(t){var a=document.querySelector("#"+this.table+"-grid");return a.style.height=this.getPanelHeight(t),new agGrid.Grid(a,this.grid),e(a).on("click",'[data-toggle="event"]',(function(){var t=e(this).data();t.master_id>0&&i.action[t.action](t)})),a},this.getPanelHeight=function(t){return"calc(100vh - "+(e(".gdoo-list-grid").position().top+t+"px")+")"},this.init=function(a){var i=this;if(0==i.header.init){var o=a.header;i.header.init=!0,i.header.create_btn=o.create_btn,i.header.trash_btn=o.trash_btn,i.header.name=o.name,i.header.table=t;var n=o.search_form;if(n.simple_search=o.simple_search_form,i.header.search_form=n,i.search.forms=n.forms,i.action.table=t,i.action.name=o.master_name,i.action.bill_url=o.bill_uri,o.access&&(i.header.access=o.access),o.right_buttons&&(i.header.right_buttons=o.right_buttons),o.left_buttons&&(i.header.left_buttons=o.left_buttons),o.buttons&&(i.header.center_buttons=o.buttons),o.bys)if(i.header.bys=o.bys,n.params.by){i.header.bys.active=n.params.by;for(var r=0;r<o.bys.items.length;r++){var l=o.bys.items[r];l.value==n.params.by&&(i.header.bys.name=l.name)}}else i.header.bys.active=o.bys.items[0].value,i.header.bys.name=o.bys.items[0].name;o.tabs&&(i.header.tabs=o.tabs,i.header.tabs.active=n.params.tab?n.params.tab:o.tabs.items[0].value),i.grid.api.setColumnDefs(o.columns),i.grid.columnDefs=o.columns,i.grid.remoteParams=n.query,e("#"+t+"-page").show(),setTimeout((function(){i.searchForm()}),1)}},this.searchForm=function(){var t=this;t.search.advanced.el=e("#"+t.table+"-search-form-advanced").searchForm({data:t.search.forms,advanced:!0}),t.search.simple.el=e("#"+t.table+"-search-form").searchForm({data:t.search.forms}),t.search.simple.el.find("#search-submit").on("click",(function(){var a=t.search.simple.el.serializeArray(),i={};return t.search.queryType="simple",e.map(a,(function(e){i[e.name]=e.value})),i.page=1,t.grid.remoteData(i),!1}))},this.setup={header:this.header,action:this.action,grid:this.grid},a.grids[t]={grid:this.grid,search:this.search}}};window.gdoo=a}(jQuery);var select2List={};!function(e){e.fn.select2Field=function(t){$this=e(this);var a=$this.attr("key"),i=gdoo.event.get(a),o={width:"100%",placeholder:" - ",allowClear:!0,minimumInputLength:0,resultCache:!0,ajax:{type:"POST",url:"",dataType:"json",delay:250,cache:!1,data:function(e){var a=t.ajaxParams||{};return a.q=e.term||"",a.page=e.page||1,a.resultCache=!0,i.trigger("query",a),a},processResults:function(e,t){return{results:e.data,pagination:{more:e.current_page<e.last_page}}}},escapeMarkup:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},createTag:function(t){var a=e.trim(t.term);return""===a?null:{id:"draft_"+a,text:a}},initSelection:function(e,t){t({id:e.val(),text:e.text()})}};t=e.extend(!0,{},o,t),i.trigger("init",t);var n=$this.select2(t);return n.on("select2:select",(function(e){i.trigger("onSelect",e.params.data)})),n.on("select2:opening",(function(){})),n.on("select2:open",(function(){})),n}}(jQuery),function(e){"use strict";var t=null,a={query:{},item:{},data:[],delay:300,showBtn:!0,clearable:!1,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13};function i(t,a){var i=e("#gdoo-suggest");i.is(":visible")&&(i.hide(),t.trigger("onHideSuggest",[a?a.data:[]]))}function o(a,i,o){!function(t,a){var i=e("#gdoo-suggest");i.is(":visible")||(i.show(),t.trigger("onShowSuggest",[a?a.data:[]]))}(a,i);var n=gdoo.event.get(o.form_id+"."+o.id);return n.trigger("open",o),n.trigger("query",o),o.suggest=!0,o.q=a.val(),t.rowSelection=1==o.multi?"multiple":"single",t.remoteDataUrl=app.url(o.url),t.remoteParams=o,t.remoteData(),a}e.fn.gdooDialogInput=function(n){return n=n||{},n=e.extend(!0,{},a,n),e("body").append('<div class="gdoo-gird-suggest" id="gdoo-suggest" style="position:absolute;display:none;box-shadow:0 2px 5px 0 rgb(0 0 0 / 26%);"></div>'),this.each((function(){var a=e(this),r=a.data(),l=null,s=0,d=e("#gdoo-suggest");!function(a,o,n){e("#gdoo-suggest").html('<div style="height:180px;overflow:auto;width:auto;"><div id="suggest-aggrid" class="ag-theme-balham" style="width:100%;height:180px;border-left:1px solid #BDC3C7;border-right:1px solid #BDC3C7;"></div></div>');var r=document.querySelector("#suggest-aggrid");(t=new agGridOptions).suppressRowClickSelection=!0,t.columnDefs=[{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"code",headerName:"存货编码",width:100},{suppressMenu:!0,cellClass:"text-left",sortable:!0,field:"name",headerName:"产品名称",minWidth:140},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"spec",headerName:"规格型号",width:100},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"barcode",headerName:"产品条码",width:120},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"unit_id_name",headerName:"计量单位",width:80},{suppressMenu:!0,cellClass:"text-right",field:"price",headerName:"价格",width:80}],t.onRowClicked=function(e){t.dialogSelected([e.data])&&i(a,o)},t.dialogSelected=function(a){var i=t.remoteParams,o=1==i.prefix?"sid":"id",n=[],r=[];e.each(a,(function(e,t){n.push(t[o]),r.push(t.name)}));var l=i.form_id+"_"+i.id;e("#"+l).val(n.join(",")),e("#"+l+"_text").val(r.join(","));var s=gdoo.event.get(i.form_id+"."+i.id);return!s.exist("onSelect")||s.trigger("onSelect","multiple"==t.rowSelection?a:a[0])},new agGrid.Grid(r,t)}(a,n),a.off(),a.on("keydown",(function(e){d.is(":visible")&&e.keyCode===n.keyEnter&&i(a,n)})).on("keyup input paste",(function(t){~e.inArray(t.keyCode,[n.keyDown,n.keyUp,n.keyEnter])?a.val(a.val()):(clearTimeout(l),l=setTimeout((function(){o(a,n,r)}),n.delay))})).on("focus",(function(){d.off();var t=e(window).width(),i=e(window).height(),o=a.outerWidth(),n=a.outerHeight(),r=a.offset(),l=d.outerWidth(),c=d.outerHeight(),u={top:r.top+n-1};t<768?(u.minWidth=360,u.left=14,u.right=14):(u.left=r.left,t<r.left+l+10&&(u.left=r.left-l+o),i<r.top+c+10&&(u.top=r.top-c+1)),d.css(u),d.on("mouseenter",(function(){s=1,a.blur()})).on("mouseleave",(function(){s=0,a.focus()})).on("click",(function(){return!1}))})).on("blur",(function(){s||i(a,n)}))}))}}(jQuery),function(e){"use strict";e.fn.searchForm=function(t){var a=this,i=[],o=t.data,n=1==t.advanced||1==o.advanced?1:0,r=a.attr("id"),l=!1,s="search-field-",d="search-condition-",c="search-value-";function u(t,n,r){a.find("#"+c+n),i[n]={condition:a.find("#"+d+n),value:a.find("#"+c+n)},function(t,a,o){var n=i[t].condition.empty(),r={};1==l&&(o="");if(r.number=[{key:"eq",value:"等于"},{key:"neq",value:"不等于"},{key:"gt",value:"大于"},{key:"lt",value:"小于"}],r.date=[{key:"eq",value:"等于"},{key:"neq",value:"不等于"},{key:"gt",value:"大于"},{key:"lt",value:"小于"}],r.second=[{key:"eq",value:"等于"},{key:"neq",value:"不等于"},{key:"gt",value:"大于"},{key:"lt",value:"小于"}],r.text=[{key:"like",value:"包含"},{key:"not_like",value:"不包含"},{key:"eq",value:"等于"},{key:"neq",value:"不等于"},{key:"gt",value:"大于"},{key:"lt",value:"小于"},{key:"empty",value:"为空"},{key:"not_empty",value:"不为空"}],"second"==a||"text"==a||"number"==a||"date"==a){var s=o||r[a][0].key;e.map(r[a],(function(e){n.append('<option value="'+e.key+'">'+e.value+"</option>")})),n.parent("div").css("display","inline-block")}else if("birthday"==a){n.append('<option value="birthday">birthday</option>'),n.parent("div").hide();s="birthday"}else if("date2"==a){n.append('<option value="date2">date2</option>'),n.parent("div").hide();s="date2"}else if("region"==a){n.append('<option value="region">region</option>'),n.parent("div").hide();s="region"}else if("second2"==a){n.append('<option value="second2">second2</option>'),n.parent("div").hide();s="second2"}else if("dialog"==a){n.append('<option value="dialog">dialog</option>'),n.parent("div").hide();s="dialog"}else{n.append('<option value="eq">eq</option>'),n.parent("div").hide();s="eq"}n.val(s),p(t,s),n.on("change",(function(){p(t,e(this).val())}))}(n,t,o.condition[n]||""),g[t].call(a,n,r)}function p(e,t){var a=i[e].value;"empty"==t||"not_empty"==t?a.hide():a.show()}function f(e,t){var a=c,i={},n="",s="";if(null!=t&&(n="-"+t,s="_"+t),i.id=r+"_"+a+e+n,i.name="search_"+e+s,0==l)if(n){var d=o.search[e][t];i.value=null==d?"":d}else{d=o.search[e];i.value=null==d?"":d}else i.value="";return i}n&&(s="advanced-"+s,d="advanced-"+d,c="advanced-"+c),a._select=function(t,a,o,r){var l,s,d,c=f(a,o),u=(l=t,s=e.type(l),d=1==n?'<option value=""> - </option>':"","array"==s||"object"==s?e.map(l,(function(e){d+='<option value="'+e.id+'">'+e.name+"</option>"})):d=d.concat(l),d),p=e('<select name="'+c.name+'" id="'+c.id+'" class="form-control input-sm">'+u+"</select>");i[a].value.append(p),""!==c.value&&p.val(c.value)},a._text=function(t,a,o){var n=f(t,a),r=e('<input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" class="form-control input-sm">');i[t].value.append(r)},a._year=function(t,a,o){var n=f(t,a),r=e('<input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" autocomplete="off" data-toggle="date" data-format="yyyy" class="form-control input-sm">');i[t].value.append(r)},a._date=function(t,a,o){var n=f(t,a),r=e('<input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" autocomplete="off" data-toggle="date" class="form-control input-sm">');i[t].value.append(r)},a._date2=function(t,a,o){var n=f(t,0),r=f(t,1),l=e('<table class="table date-field"><tr><td><input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" data-toggle="date" autocomplete="off" class="form-control input-sm"></td><td class="date-apart"> - </td><td><input name="'+r.name+'" id="'+r.id+'" value="'+r.value+'" type="text" autocomplete="off" data-toggle="date" class="form-control input-sm"></td></tr></table>');i[t].value.append(l)},a._second2=function(t,a,o){var n=f(t,0),r=f(t,1),l=e('<table class="table date-field"><tr><td><input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" autocomplete="off" data-toggle="date" class="form-control input-sm"></td><td class="date-apart"> - </td><td><input name="'+r.name+'" id="'+r.id+'" value="'+r.value+'" type="text" autocomplete="off" data-toggle="date" class="form-control input-sm"></td></tr></table>');i[t].value.append(l)},a._birthday=function(t,a,o){var n=f(t,0),r=f(t,1),l=e('<input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" data-toggle="date" autocomplete="off" data-format="MM-dd" class="form-control input-sm"> - <input name="'+r.name+'" id="'+r.id+'" value="'+r.value+'" type="text" data-toggle="date" autocomplete="off" data-format="MM-dd" class="form-control input-sm">');i[t].value.append(l)},a._birthday2=function(t,a,o){var n=f(t,0),r=f(t,1),l=e('<input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" data-toggle="date" autocomplete="off" data-format="MM-dd" class="form-control input-sm"> - <input name="'+r.name+'" id="'+r.id+'" value="'+r.value+'" type="text" data-toggle="date" autocomplete="off" data-format="MM-dd" class="form-control input-sm">');i[t].value.append(l)},a._dialog=function(t,o,r,l){var d=f(o,r),c=[];if(t.query&&(t.query.multi="undefined"==t.query.multi?1:t.query.multi,e.each(t.query,(function(e,t){c.push("data-"+e+'="'+t+'"')}))),n)var u=a.find("#"+s+o);else u=a.find("#"+s+"0").find("option:selected");var p='<div class="select-group input-group">';p+='<input class="form-control input-sm" data-toggle="dialog-view" readonly="readonly" data-title="'+u.data().title+'" data-url="'+t.url+'" data-id="'+d.id+'" '+c.join(" ")+' style="min-width:153px;cursor:pointer;" id="'+d.id+'_text" />',p+='<input type="hidden" id="'+d.id+'" name="'+d.name+'" value="'+d.value+'">',p+='<div class="input-group-btn">',p+='<a data-toggle="dialog-clear" data-id="'+d.id+'" class="btn btn-sm btn-default"><i class="fa fa-times"></i></a>',p+="</div>",i[o].value.append(e(p))};var g={empty:function(e){i[e].value.empty()},text:function(e){a._text(e)},select2:function(e){a._text(e)},select:function(e,t){a._select(t,e)},number:function(e){a._text(e)},year:function(e){a._year(e)},date:function(e){a._date(e)},date2:function(e){a._date2(e)},birthday:function(e){a._birthday(e)},dialog:function(e,t){a._dialog(t,e)},second:function(e){a._date(e)},second2:function(e){a._second2(e)},option:function(e,t){a._select(t,e)},address:function(e){var t=f(e,0),a=f(e,1),o='<select name="'+t.name+'" id="'+t.id+'" class="form-control input-sm"></select>&nbsp;<select name="'+a.name+'" id="'+a.id+'" class="form-control input-sm"></select>';i[e].value.append(o),new pcas(t.id,a.id,t.value,a.value)},region:function(t){var o=f(t,0),n=f(t,1),r=f(t,2),l=o.value,s=n.value,d=r.value;function c(t,a){e.get(app.url("index/api/region",{layer:2,parent_id:l}),(function(t){var a="";e.map(t,(function(e){a+='<option value="'+e.id+'">'+e.name+"</option>"}));var i=e("#"+n.id).html(a);s&&i.val(s)}))}function u(t,a){e.get(app.url("index/api/region",{layer:3,parent_id:s}),(function(t){var a="";e.map(t,(function(e){a+='<option value="'+e.id+'">'+e.name+"</option>"}));var i=e("#"+r.id).html(a);d&&i.val(d)}))}i[t].value.append('<select name="'+o.name+'" id="'+o.id+'" class="form-control input-sm"></select>&nbsp;<select name="'+n.name+'" id="'+n.id+'" class="form-control input-sm"></select>&nbsp;<select name="'+r.name+'" id="'+r.id+'" class="form-control input-sm"></select>'),e.get(app.url("index/api/region",{layer:1}),(function(i){var r="";e.map(i,(function(e){r+='<option value="'+e.id+'">'+e.name+"</option>"}));var p=e("#"+o.id).html(r);l&&p.val(l),c(t),u(t),a.on("change","#"+o.id,(function(){l=this.value,s=0,d=0,c(t),u(t)})),a.on("change","#"+n.id,(function(){s=this.value,d=0,u(t)}))}))},circle:function(t){var o=a.attr(t,0),n=a.attr(t,1),r=o.value,l=n.value;function s(t){var a='<option value=""> - </option>';r?e.post(app.url("customer/customer/dialog",{limit:500,circle_id:r}),(function(t){e.map(t.data,(function(e){a+='<option value="'+e.id+'">'+e.text+"</option>"}));var i=e("#"+n.id).html(a);l&&i.val(l)})):e("#"+n.id).html(a)}i[t].value.append('<select name="'+o.name+'" id="'+o.id+'" class="form-control input-sm"></select>&nbsp;<select name="'+n.name+'" id="'+n.id+'" class="form-control input-sm"></select>'),e.post(app.url("customer/circle/dialog"),(function(a){var i='<option value=""> - </option>';e.map(a,(function(e){i+='<option value="'+e.id+'">'+e.name+"</option>"}));var n=e("#"+o.id).html(i);r&&n.val(r),s(t)})),a.on("change","#"+o.id,(function(){r=this.value,l=0,s(t)}))}};return a.attr=f,a.element=i,a.options=t,"function"==typeof t.init&&t.init.call(this,g),function(){if(n)e.each(o.field,(function(e){u(a.find("#"+s+e).data("type"),e,o.option[e])}));else{var t=a.find("#"+s+"0");t.val(o.field[0]),u(t.find("option:selected").data("type"),0,o.option[0]),t.on("change",(function(){l=!0;var t=this.selectedIndex-1,a=e(this).find("option:selected").data("type");i[0].value.empty(),u(a,0,o.option[t])}))}}(),this}}(jQuery),function(e){var t=0;e.fn.dialog=function(a){var i=this,o=e(i),n=e(document.body),r=o.closest(".dialog");this.options=a;var l,s=function(){r.modal("show"),(a.onShow||function(){}).call(i)},d=function(){r.modal("hide")};if(a.constructor==Object){a=e.extend({show:!0,backdrop:!0,destroy:!1},a),0==r.size()&&(l='<div class="dialog modal"><div class="modal-dialog"><div class="modal-content">',a.title&&(l+='<div class="modal-header"><button type="button" data-dismiss="dialog" class="close">&times;</button><h4 class="modal-title"></h4></div>'),l+='<div class="modal-body"></div>',a.buttons.length>0&&(l+='<div class="modal-footer"></div>'),r=e(l+="</div></div></div>"),n.append(r),r.find(".modal-body").append(o),r.modal({backdrop:a.backdrop}),e(".modal-dialog").draggable({handle:".modal-header",iframeFix:!0}),function(t){var o=(t||a||{}).buttons||{},n=r.find(".modal-footer");for(var l in n.html(""),o){var s=o[l],d="btn-default";d=s.class||s.classed||d,$button=e('<button type="button" class="btn btn-sm '+d+'">'+s.text+"</button>"),$button.data("click",s.click),s.id&&$button.attr("id",s.id),n.append($button)}n.on("click",(function(t){var a=e(t.target).data("click");"function"==typeof a&&a.call(i,t)})),n.data("buttons",o)}(),r.find(".modal-title").html(a.title),a.dialogClass&&r.find(".modal-dialog").addClass(a.dialogClass),r.on("click","[data-dismiss='dialog']",(function(){(a.onClose||d).call(i)})),r.one("show.bs.modal",(function(){t++})),r.one("hidden.bs.modal",(function(){--t>0&&(r.modal("checkScrollbar"),n.addClass("modal-open"),r.modal("setScrollbar")),1==a.destroy&&r.remove()})),a.modalClass&&r.addClass(a.modalClass)),a.show&&s()}return"destroy"==a&&(a.destroy=!0,d()),"close"==a&&d(),"show"==a&&s(),i}}(jQuery),function(e){var t={text:"确定",classed:"btn-info"},a={text:"取消",classed:"btn-default"};e.messager={},e.messager.alert=function(a,i,o){arguments.length<2&&(i=a||"",a="&nbsp;"),e("<div>"+i+"</div>").dialog({title:a,destroy:!0,dialogClass:"modal-sm",buttons:[{text:t.text,classed:t.classed||"btn-success",click:function(){"function"==typeof o&&o(),e(this).dialog("destroy")}}]})},e.messager.confirm=function(i,o,n){e("<div>"+o+"</div>").dialog({title:i,destroy:!0,backdrop:"static",dialogClass:"modal-sm modal-confirm",buttons:[{text:a.text,classed:a.classed||"btn-danger",click:function(){e(this).dialog("destroy"),"function"==typeof n&&n(!1)}},{text:t.text,classed:t.classed||"btn-success",click:function(){e(this).dialog("destroy"),"function"==typeof n&&n(!0)}}]})}}(jQuery),function(e){var t=0;e.dialog=function(a){var i=t,o={title:"Dialog",modalClass:"no-padder",dialogClass:"modal-md",destroy:!0,index:t,onShow:function(){var t=this;if(o=a.url){var o=o+(o.indexOf("?")<0?"?":"&")+"dialog_index="+i;e.get(o,(function(e){t.html(e)}))}a.html&&this.html(a.html)},buttons:[{text:"取消",click:function(){e(this).dialog("close")}},{text:"确定",class:"btn-primary",click:function(){e(this).dialog("close")}}]};a=e.extend(o,a);var n="gdoo-dialog-"+t,r=e("#"+n);return 0==r.length&&(r=e("<div/>",{id:n}),t++),r.dialog(a),i}}(jQuery),jQuery.toastr=function(e,t,a){toastr.options={closeButton:!0,debug:!1,progressBar:!1,positionClass:"toast-top-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},toastr[e](t,a)},function(window){var calc={rmb:function(e){var t,a,i,o,n,r,l,s,d,c,u,p,f,g,h="零",m="壹",v="贰",y="叁",w="肆",b="伍",x="陆",_="柒",$="捌",k="玖",C="拾",S="佰",D="仟",M="万",E="亿",N="元",I="角",R="分",j="整";if(""==(e=e.toString()))return"";if(null!=e.match(/[^,.\d]/))return"";if(null==e.match(/^((\d{1,3}(,\d{3})*(.((\d{3},)*\d{1,3}))?)|(\d+(.\d+)?))$/))return"";if(e=(e=e.replace(/,/g,"")).replace(/^0+/,""),Number(e)>99999999999.99)return"";if((o=e.split(".")).length>1?(t=o[0],a=(a=o[1]).substr(0,2)):(t=o[0],a=""),n=new Array(h,m,v,y,w,b,x,_,$,k),r=new Array("",C,S,D),l=new Array("",M,E),s=new Array(I,R),i="",Number(t)>0){for(d=0,c=0;c<t.length;c++)f=(u=t.length-c-1)/4,g=u%4,"0"==(p=t.substr(c,1))?d++:(d>0&&(i+=n[0]),d=0,i+=n[Number(p)]+r[g]),0==g&&d<4&&(i+=l[f]);i+=N}if(""!=a)for(c=0;c<a.length;c++)"0"!=(p=a.substr(c,1))&&(i+=n[Number(p)]+s[c]);return""==i&&(i=h+N),""==a&&(i+=j),i},max:function(){if(0!=arguments.length){for(var e=arguments[0],t=0;t<arguments.length;t++)e=Math.max(e,arguments[t]);return parseFloat(e)}},min:function(){if(0!=arguments.length){for(var e=arguments[0],t=0;t<arguments.length;t++)e=Math.min(e,arguments[t]);return parseFloat(e)}},avg:function(){for(var e=arguments,t=e.length,a=0,i=0;a<t&&(i+=parseFloat(e[a]));a++);return i/t},mod:function(){if(0!=arguments.length){var e=arguments[0],t=arguments[1],a=e%t;return a=isNaN(a)?"":parseFloat(a)}},abs:function(e){return Math.abs(parseFloat(e))},val:function(e,t){return isNaN(e)||e===1/0?0:e.toFixed(t)},day:function(e){return 0==e?0:Math.floor(e/86400)},hour:function(e){return 0==e?0:Math.floor(e/3600)},date:function(e){var t="天",a="小时",i="分",o="秒",n="日期格式无效";return e>=0?Math.floor(e/86400)+t+Math.floor(e%86400/3600)+a+Math.floor(e%3600/60)+i+Math.floor(e%60)+o:n},list:function(e,t){for(var a=0,i=document.getElementById("body_"+e),o=0;o<i.rows.length;o++)for(var n=0;n<i.rows[o].cells.length;n++)if(n==t){var r=i.rows[o].cells[n].firstChild;if(r&&r.tagName){var l=r.value||r.innerText;l=""==l||""==l.replace(/\s/g,"")?0:l,l=isNaN(l)?NaN:l,a+=parseFloat(l)}else a+=parseFloat(r.data)}return parseFloat(a)},getVal:function(e,t){var a=$("#"+e);if(0==a.length)return 0;if("listview"==t)return document.getElementById("lv_"+e);if("date"==t){var i=$("#"+e).val();return new Date(i).getTime()/1e3}return""==(i=a.val())&&(i=0),i},sum:function(){var e,t,a=[].slice.call(arguments,0),i=0;for(e=a.length;e--;)i+=(t=parseFloat(a[e]))==t?t:0;return i}},listView={calc,field:{},data:{},total:{},editor:function(e,t,a){var i=listView.field[e],o=i.type[a],n=i.size[a],r="SYS_NOT_NULL"==i.checks[a]?"input-required":"input-text",l=1!=i.writes[a],s="";listView.data[e][t]&&(s=null==listView.data[e][t][a]?"":listView.data[e][t][a]);var d=e+"["+t+"]["+a+"]",c=e+"_"+t+"_"+a;switch(o){case"empty":var u='<span tyle="width:'+n+'px;" id="'+c+'"></span>';break;case"text":u=0==l?'<input autocomplete="off" type="text" style="width:'+n+'px;" class="'+r+'" name="'+d+'" id="'+c+'" value="'+s+'">':'<span id="'+c+'">'+s+"</span>";break;case"textarea":u=0==l?'<textarea style="width:'+n+'px;" class="'+r+'" name="'+d+'" id="'+c+'">'+s+"</textarea>":'<span id="'+c+'">'+s+"</span>";break;case"calc":u=0==l?'<input type="text" style="width:'+n+'px;" class="readonly" name="'+d+'" id="'+c+'" value="'+s+'" readonly>':'<span id="'+c+'">'+s+"</span>";break;case"select":var p=i.value[a].split(",");(g=[]).push("<select style=width:"+n+'px;" name="'+d+'" id="'+c+'">');for(t=0;t<p.length;t++){var f=s==p[t]?" selected":"";g.push('<option value="'+p[t]+'"'+f+">"+p[t]+"</option>")}g.push("</select>"),u=0==l?g.join("\n"):'<span id="'+c+'">'+s+"</span>";break;case"radio":p=i.value[a].split(",");var g=[];for(t=0;t<p.length;t++){var h=s==p[t]?" checked":"";g.push('<label class="checkbox"><input type="radio" name="'+d+'" id="'+c+'"'+h+">"+p[t]+"</label>")}u=0==l?g.join("\n"):'<span id="'+c+'">'+s+"</span>";break;case"checkbox":for(p=i.value[a].split(","),g=[],t=0;t<p.length;t++){h=s==p[t]?" checked":"";g.push('<label class="checkbox"><input type="checkbox" name="'+d+'" id="'+c+'"'+h+">"+p[t]+"</label>")}u=0==l?g.join("\n"):'<span id="'+c+'">'+s+"</span>";break;case"datetime":u=0==l?'<input autocomplete="off" type="text" style=width:'+n+'px;" onfocus="datePicker({dateFmt:\'yyyy-MM-dd\'});" class="'+r+' popDate" value="'+s+'" name="'+d+'" id="'+c+'">':'<span id="'+c+'">'+s+"</span>"}return u},rowUpdate:function(e){var t=e.target.id.split("_");if(4==t.length){var a=t[0]+"_"+t[1];listView.rowSum(a,t[2]),listView.footerSum(a)}},footerSum:function(e){for(var t=document.getElementById("body_"+e),a=listView.field[e],i=a.sum,o=(a.readonly,0);o<i.length;o++)if(1==i[o]){for(var n=0,r=0;r<t.rows.length;r++){var l=t.rows[r].cells[o+1],s=0==a.readonly?$(l).find("input,select").val():$(l).find("span").text();s=parseFloat(s),n+=isNaN(s)?0:Math.round(1e4*parseFloat(s))/1e4}n=n.toFixed(2),$("#total_"+e+"_"+o).html(n)}},rowSum:function rowSum(key,j){for(var field=listView.field[key],type=field.type,value=field.value,readonly=field.readonly,calc=[],i=0;i<type.length;i++)if("calc"==type[i]){calc[i]=value[i];for(var k=0;k<type.length;k++){var n=k+1,td=$("#"+key+"_"+j+"_"+k),td_value=0==readonly?td.val():td.text();calc[i]=calc[i].replace("["+n+"]",parseFloat(td_value))}row=isNaN(eval(calc[i]))?0:Math.round(1e4*parseFloat(eval(calc[i])))/1e4,row=row.toFixed(2);var obj=$("#"+key+"_"+j+"_"+i);0==readonly?obj.val(row):obj.text(row)}},rowAdd:function(e){i=listView.total[e];var t=[];t.push('<tr><td align="center">'+(i+1)+"</td>");for(var a=0;a<listView.field[e].type.length;a++)t.push("<td>"+listView.editor(e,i,a)+"</td>");if(0==listView.field[e].readonly){var o=i>0?'<a class="option" href="javascript:;" onclick="listView.deleteRow(\''+e+"',this);\">删除</a>":'<a class="option" onclick="listView.rowAdd(\''+e+'\');" href="javascript:;">添加</a>';t.push('<td align="center" style="white-space:nowrap;">'+o+"</td></tr>")}$("#body_"+e).append(t.join("\n")),listView.total[e]++},deleteRow:function(e,t){var a=t.parentNode.parentNode;a.parentNode.removeChild(a),listView.footerSum(e)},init:function(e){listView.total[e]=0;for(var t=listView.data[e].length>0?listView.data[e].length:1,a=0;a<t;a++)listView.rowAdd(e),listView.rowSum(e,a);listView.footerSum(e)}};window.listView=listView}(window),function(e){function t(e){var t={},a=formGridList[e]||[];if(a.length)for(var i=0;i<a.length;i++){var o=a[i],n=o.api.memoryStore,r=[];o.api.stopEditing(),o.api.forEachNode((function(e){var t=e.data;isNotEmpty(t[o.dataKey])&&(0===(""+t.id).indexOf("draft_")&&(t.id=0),r.push(t))}));var l=gdoo.event.get("grid."+o.tableKey);if(l.exist("onSaveBefore"))if(!1===l.trigger("onSaveBefore",r))return!1;if(0==r.length&&!0===o.tableSaveDataNotEmpty)return toastrError(o.tableTitle+" 不能为空。"),!1;t[o.tableKey]={rows:r,deleteds:n.deleted}}return t}function a(e){for(var t=top.document.getElementsByTagName("iframe"),a=0;a<t.length;a++){var i=t[a],o=i.contentWindow.gdoo;if("tab_iframe_dashboard"==i.id)Object.values(o.widgets).forEach((function(e){e.remoteData()}));else if(o&&o.grids){var n=o.grids;n[e]&&n[e].grid.remoteData()}}}e.gridListData=t;var i={bill_url:"",audit:function(e){var i=$("#"+e),o=i.find("#master_key").val(),n=i.find("#master_run_id").val(),r=i.find("#master_step_id").val(),l=i.find("#master_run_log_id").val(),s=$("#"+e).find("#master_uri").val(),d=app.url(s+"/flowAudit",{key:o,run_id:n,step_id:r,run_log_id:l});$.dialog({title:"单据审批",url:d,buttons:[{text:"取消",class:"btn-default",click:function(){$(this).dialog("close")}},{text:"提交",class:"btn-info",click:function(){var i=$("#myturn,#"+e).serialize(),o=t(e);if(!1!==o){var n=showLoading();$.post(app.url(s+"/flowAudit"),i+"&"+$.param(o),(function(t){t.status?(a(e),toastrSuccess(t.data),t.url&&(location.href=t.url)):toastrError(t.data)}),"json").complete((function(){layer.close(n)}))}}}]})},draft:function(e){var i=$("#"+e).find("#master_uri").val(),o=$("#myturn,#"+e).serialize(),n=t(e);if(!1!==n){var r=showLoading(),l=gdoo.event.get("grid."+e);$.post(app.url(i+"/flowDraft"),o+"&"+$.param(n),(function(t){l.exist("onSaveAfter")&&(t=l.trigger("onSaveAfter",t)),t.status?(a(e),toastrSuccess(t.data),t.url&&(location.href=t.url)):toastrError(t.data)}),"json").complete((function(){layer.close(r)}))}},remove:function(e){$.messager.confirm("操作警告","确定要删除吗？",(function(t){1==t&&$.post(e,(function(e){e.status?(toastrSuccess(e.data),location.reload()):toastrError(e.data)}),"json")}))},store:function(e){var i=$("#"+e).find("#master_uri").val(),o=$("#"+e).serialize(),n=t(e);if(!1!==n){var r=showLoading();$.post(app.url(i+"/store"),o+"&"+$.param(n),(function(t){t.status?(a(e),toastrSuccess(t.data),t.url&&(location.href=t.url)):toastrError(t.data)}),"json").complete((function(){layer.close(r)}))}},read:function(e){var t=$("#"+e).find("#master_uri").val(),i=$("#"+e).serialize(),o=showLoading();$.post(app.url(t+"/flowRead"),i,(function(t){t.status?(a(e),toastrSuccess(t.data),location.reload()):toastrError(t.data)}),"json").complete((function(){layer.close(o)}))},reset:function(e){$.messager.confirm("操作警告","确定要重置流程吗",(function(t){if(1==t){var a=$("#"+e).find("#master_uri").val(),i=$("#"+e).serialize(),o=showLoading();$.post(app.url(a+"/flowReset"),i,(function(e){e.status?location.reload():toastrError(e.data)}),"json").complete((function(){layer.close(o)}))}}))},auditLog:function(e){var t=app.url("index/workflow/flowLog",{key:e});$.dialog({title:"审批记录",dialogClass:"modal-lg",url:t,buttons:[{text:"取消",class:"btn-default",click:function(){$(this).dialog("close")}}]})},revise:function(e){formDialog({title:"流程修正",url:app.url("index/workflow/flowRevise",{key:e}),dialogClass:"modal-md",id:"revise-form",success:function(e){toastrSuccess(e.data),location.reload(),$(this).dialog("close")},error:function(e){toastrError(e.data)}})},recall:function(e){var t=$("#"+e).find("#master_key").val(),i=$("#"+e).find("#master_uri").val(),o=$("#"+e).find("#master_recall_log_id").val(),n=app.url(i+"/recall",{key:t,log_id:o});$.dialog({title:"撤回单据",url:n,buttons:[{text:"取消",class:"btn-default",click:function(){$(this).dialog("close")}},{text:"提交",class:"btn-info",click:function(){var t=$("#myrecall").serialize(),o=showLoading();$.post(app.url(i+"/recall"),t,(function(t){t.status?(a(e),toastrSuccess(t.data),location.reload()):toastrError(t.data)}),"json").complete((function(){layer.close(o)}))}}]})},abort:function(e){var t=$("#"+e).find("#master_key").val(),i=$("#"+e).find("#master_uri").val(),o=app.url(i+"/abort",{key:t});$.dialog({title:"弃审单据",url:o,buttons:[{text:"取消",class:"btn-default",click:function(){$(this).dialog("close")}},{text:"提交",class:"btn-info",click:function(){var t=$("#myabort").serialize(),o=showLoading();$.post(app.url(i+"/abort"),t,(function(t){t.status?(a(e),toastrSuccess(t.data),location.reload()):toastrError(t.data)}),"json").complete((function(){layer.close(o)}))}}]})},audit2:function(e){var t=$("#"+e).find("#master_key").val(),i=$("#"+e).find("#master_uri").val();$.messager.confirm("操作警告","确定要审核单据吗",(function(o){if(1==o){var n=showLoading();$.post(app.url(i+"/audit"),{key:t},(function(t){t.status?(a(e),toastrSuccess(t.data),location.reload()):toastrError(t.data)}),"json").complete((function(){layer.close(n)}))}}))},abort2:function(e){var t=$("#"+e).find("#master_key").val(),i=$("#"+e).find("#master_uri").val();$.messager.confirm("操作警告","确定要弃审单据吗",(function(o){if(1==o){var n=showLoading();$.post(app.url(i+"/abort"),{key:t},(function(t){t.status?(a(e),top.$.toastr("success",t.data),location.reload()):top.$.toastr("error",t.data)}),"json").complete((function(){layer.close(n)}))}}))},createRow:function(t){var a=gdoo.forms[t],i=e[t+".onCreateRow"];if("function"==typeof i&&!1===i.call(a,t))return!1;a.api.memoryStore.create({})},deleteRow:function(t){var a=gdoo.forms[t],i=e[t+".onDeleteRow"];if("function"==typeof i&&!1===i.call(a,t))return!1;var o=a.api.getSelectedNodes();if(o&&1===o.length){var n=o[0];a.api.deleteRow(n.data),a.api.forEachNode((function(e){e.childIndex!==n.childIndex||e.setSelected(!0)}))}},quickFilter:function(e){var t=gdoo.forms[e],a=$("#"+e+"_quick_filter_text"),i=a.dialog({title:'<i class="fa fa-filter"></i> 过滤'+t.tableTitle,modalClass:"no-padder",dialogClass:"modal-sm",buttons:[{text:"确定",classed:"btn-info",click:function(){t.api.setQuickFilter(a.find("input").val()),i.dialog("close")}},{text:"取消",classed:"btn-default",click:function(){i.dialog("close")}}]}).on("keydown",(function(e){13==e.keyCode&&(t.api.setQuickFilter(a.find("input").val()),i.dialog("close"))}))},closeRow:function(e){var t=this,a=gdoo.forms[e],i=a.api.getSelectedRows();if(i.length>0){var o=i[0].id;top.$.messager.confirm("操作提醒","是否要关闭选中的行数据?",(function(i){if(1==i){var n=showLoading();$.post(app.url(t.bill_url+"/closeRow"),{table:e,id:o},(function(e){e.status?(toastrSuccess(e.data),a.remoteData()):toastrError(e.data)}),"json").complete((function(){layer.close(n)}))}}))}else toastrError("最少选择一行记录。")},closeAllRow:function(e){var t=this,a=gdoo.forms[e],i=[];a.api.forEachNode((function(e){i.push(e.data.id)})),i.length>0?top.$.messager.confirm("操作提醒","是否要关闭所有行数据?",(function(o){if(1==o){var n=showLoading();$.post(app.url(t.bill_url+"/closeAllRow"),{table:e,ids:i},(function(e){e.status?(toastrSuccess(e.data),a.remoteData()):toastrError(e.data)}),"json").complete((function(){layer.close(n)}))}})):toastrError("最少选择一行记录。")}};e.flow=i}(window),function(e){window.gridAction=function(t,a){this.name=a,this.table=t,this.dialogType="dialog",this.show=function(t,a,i){var o=this;if(1!=t.flow_form_edit){var n=app.url(o.bill_url+"/show",{id:t.master_id});"dialog"==o.dialogType?viewDialog({title:o.name,dialogClass:"modal-lg",url:n,close:function(){e(this).dialog("close")}}):(isEmpty(a)&&(a=o.bill_url.replace(/\//g,"_")+"_show"),isEmpty(i)&&(i=o.name),top.addTab(o.bill_url+"/show?id="+t.master_id,a,i))}else o.audit(t)},this.import=function(){var t=this,a=gdoo.grids[t.table].grid;formDialog({title:"数据导入",url:app.url(t.bill_url+"/import"),dialogClass:"modal-md",id:"import-dialog",onSubmit:function(){var i=new FormData;i.append("file",e("#import_file")[0].files[0]);var o=showLoading();e.ajax({url:app.url(t.bill_url+"/import"),type:"POST",data:i,processData:!1,contentType:!1,complete:function(){layer.close(o)},success:function(t){t.status?(e("#modal-import-dialog").dialog("close"),a.remoteData(),toastrSuccess(t.data)):toastrError(t.data)}})}})},this.delete=function(){var t=this,a=gdoo.grids[t.table].grid,i=a.api.getSelectedRows(),o=[];if(e.each(i,(function(e,t){o.push(t.master_id)})),o.length>0){var n=o.length+"个"+t.name+"将被删除？";top.$.messager.confirm("删除"+t.name,n,(function(i){if(1==i){var n=showLoading();e.post(app.url(t.bill_url+"/delete"),{id:o},(function(e){e.status?(toastrSuccess(e.data),a.remoteData()):toastrError(e.data)}),"json").complete((function(){layer.close(n)}))}}))}else toastrError("最少选择一行记录。")},this.created_by=function(t){var a=gdoo.grids[this.table].grid;formDialog({title:"私信",url:app.url("user/message/create",{user_id:t.id}),storeUrl:app.url("model/form/store"),id:"user_message",dialogClass:"modal-md",success:function(t){toastrSuccess(t.data),a.remoteData(),e(this).dialog("close")},error:function(e){toastrError(e.data)}})},this.create=function(){var t=this,a=gdoo.grids[t.table].grid;if("dialog"==t.dialogType)formDialog({title:"新建"+t.name,url:app.url(t.bill_url+"/create"),storeUrl:app.url(t.bill_url+"/store"),id:t.table,table:t.table,dialogClass:"modal-lg",success:function(t){toastrSuccess(t.data),a.remoteData(),e(this).dialog("close")},error:function(e){toastrError(e.data)}});else{var i=t.bill_url.replace(/\//g,"_")+"_show";top.addTab(t.bill_url+"/create",i,t.name)}},this.edit=function(t){var a=this,i=gdoo.grids[a.table].grid;if("dialog"==a.dialogType)formDialog({title:"编辑"+a.name,url:app.url(a.bill_url+"/edit",{id:t.master_id}),storeUrl:app.url(a.bill_url+"/store"),id:a.table,table:a.table,dialogClass:"modal-lg",success:function(t){toastrSuccess(t.data),i.remoteData(),e(this).dialog("close")},error:function(e){toastrError(e.data)}});else{var o=a.bill_url.replace(/\//g,"_")+"_show";top.addTab(a.bill_url+"/edit?id="+t.master_id,o,a.name)}},this.audit=function(t){var a=this,i=gdoo.grids[a.table].grid;if("dialog"==a.dialogType)formDialog({title:"审核"+a.name,url:app.url(a.bill_url+"/audit",{id:t.master_id}),storeUrl:app.url(a.bill_url+"/store"),id:a.table,table:a.table,dialogClass:"modal-lg",success:function(t){toastrSuccess(t.data),i.remoteData(),e(this).dialog("close")},error:function(e){toastrError(e.data)}});else{var o=a.bill_url.replace(/\//g,"_")+"_show";top.addTab(a.bill_url+"/audit?id="+t.master_id,o,a.name)}},this.batchEdit=function(){var t=gdoo.grids[this.table].grid,a=t.api.getSelectedRows(),i=[];e.each(a,(function(e,t){i.push(t.master_id)})),i.length>0?formDialog({title:"批量编辑",dialogClass:"modal-sm",id:"batch-edit-form",url:app.url(this.bill_url+"/batchEdit",{ids:i.join(",")}),success:function(a){toastrSuccess(a.data),t.remoteData(),e(this).dialog("close")},close:function(){e(this).dialog("close")}}):toastrError("最少选择一行记录。")},this.export=function(){LocalExport(gdoo.grids[this.table].grid,this.name)},this.filter=function(){var t=gdoo.grids[this.table],a=t.grid,i=t.search;e(i.advanced.el).dialog({title:"高级搜索",modalClass:"no-padder",buttons:[{text:"取消",class:"btn-default",click:function(){e(this).dialog("close")}},{text:"确定",class:"btn-info",click:function(){var t=i.advanced.el.serializeArray(),o={};return i.queryType="advanced",e.map(t,(function(e){o[e.name]=e.value})),o.page=1,a.remoteData(o),e(this).dialog("close"),!1}}]})}}}(jQuery);var select2List={},dialogCacheSelected={};$((function(){var e=$(document);e.ajaxError((function(e,t){t.responseJSON&&toastrError(t.responseJSON.message)}));var t=e.find(".input-select2");t.length&&t.select2(),e.tooltip({container:"body",placement:"auto",selector:".hinted",delay:{show:200,hide:0}}),$(".select-all").on("click",(function(){var e=$(".select-row").closest("tr");$(this).prop("checked")?e.addClass("success"):e.removeClass("success"),$(".select-row").prop("checked",$(this).prop("checked"))})),e.on("click",'[data-toggle="closetab"]',(function(){if(window.name)var e=window.name.replace("iframe_","");else e=$(this).data("id");top.$.addtabs.close({id:"tab_"+e})})),$(".table tbody tr").on("click",(function(e){var t=$(this),a=t.find(".select-row"),i=a.prop("checked");function o(e){e?t.addClass("success"):t.removeClass("success"),a.prop("checked",e)}0!=a.length&&("INPUT"==e.target.tagName&&o(i),"DIV"==e.target.tagName&&o(!i),"TD"==e.target.tagName&&o(!i))})),e.on("change",'[data-toggle="redirect"]',(function(){var e=$(this).data("url"),t=$(this).attr("id"),a=$(this).find("option:selected").val();location.href=e.replace(new RegExp("("+t+"=)[^&]*","g"),"$1"+a)})),e.on("click.dialog.search",'[data-toggle="dialog-clear"]',(function(){var e=$(this).data();$("#"+e.id).val(""),$("#"+e.id+"_text").val(""),gdoo.event.get(e.id).trigger("clear",e)})),e.on("click.dialog.view",'[data-toggle="dialog-view"]',(function(){var e=$(this).data(),t={};$.each(e,(function(e,a){if("url"==e||"title"==e||"toggle"==e)return!0;t[e]=a}));var a=getIframeName();a&&(t.iframe_id=a);var i=gdoo.formKey(e),o=gdoo.event.get(i.key);o.trigger("open",e,t);var n=e.url,r=e.title;n=app.url(n,t);$.dialog({title:r,url:n,dialogClass:"modal-lg",buttons:[{text:"取消",class:"btn-default",click:function(){$(this).dialog("close")}},{text:"确定",class:"btn-info",click:function(){var t=gdoo.dialogs[i.id];t?!0===gdoo.dialogSelected(o,e,i,t)&&$(this).dialog("close"):$(this).dialog("close")}}]})}));var a=e.find(".gdoo-dialog-input");a.length&&a.gdooDialogInput(),e.on("click.dialog.image",'[data-toggle="dialog-image"]',(function(){var e=$(this).data();$.dialog({title:e.title,html:'<img style="text-align:center;max-width:100%;" src="'+e.url+'" />',buttons:[{text:"确定",class:"btn-default",click:function(){$(this).dialog("close")}}]})})),e.on("click.dialog.form",'[data-toggle="dialog-form"]',(function(){var e=$(this).data();e.id=e.id||"myform",e.size=e.size||"md",$.dialog({title:e.title,url:e.url,dialogClass:"modal-"+e.size,buttons:[{text:"取消",class:"btn-default",click:function(){"function"==typeof error?error.call(this,res):$(this).dialog("close")}},{text:"保存",class:"btn-info",click:function(){var t=this,a=$("#"+e.id).attr("action"),i=$("#"+e.id).serialize();$.post(a,i,(function(e){"function"==typeof success?success.call(t,e):e.status?"reload"==e.data?window.location.reload():(toastrSuccess(e.data),$(t).dialog("close")):toastrError(e.data)}),"json")}}]})})),e.on("click.date",'[data-toggle="date"]',(function(){var e=$(this).data(),t={};t.dateFmt=e.format||"yyyy-MM-dd";var a=window[this.id+".onpicked"];"function"==typeof a&&(t.onpicked=a),e.dchanging&&(t.dchanging=e.dchanging),datePicker(t)})),e.on("click.datetime",'[data-toggle="datetime"]',(function(){var e=$(this).data(),t={};t.dateFmt=e.format||"yyyy-MM-dd HH:mm",e.dchanging&&(t.dchanging=e.dchanging),datePicker(t)})),e.on("click.frame.close",'[data-toggle="layer-frame-close"]',(function(){var e=parent.layer.getFrameIndex(window.name);parent.layer.close(e)})),e.on("click.frame.url",'[data-toggle="layer-frame-url"]',(function(){var e=$(this).data("url"),t=$(this).data("title")||!1,a=$(this).data("skin")||"frame",i=$(this).data("close")||!1;layer.open({skin:"layui-layer-"+a,scrollbar:!1,closeBtn:i,title:t,type:2,move:!1,area:["100%","100%"],content:e})})),e.on("click.tab.frame",'[data-toggle="tab-frame-url"]',(function(){var e=$(this).data("url"),t=$(this).data("id"),a=$(this).data("name");top.addTab(e,t,a)})),e.on("click",'[data-toggle="media-delete"]',(function(){var e=$(this).parent();$(this).closest(".media-controller").find(".media-item").length>1?e.remove():(e.find("img").attr("src",app.url("assets/images/nopic.jpg")),e.find("input").val(""))})),$("a.image-show").hover((function(e){var t=$(this).data(),a=$('<p id="image"><img src="'+t.url+'" alt="" /></p>');$("body").append(a),$(this).find("img").stop().fadeTo("slow",.5);var i=$(window),o=$(document).find("#image"),n=o.height(),r=o.width(),l=(i.scrollLeft(),i.width(),i.scrollTop()+(i.height()-n)/2+"px"),s=$(this).offset();o.css({left:s.left+100,top:l}),o.fadeIn("fast")}),(function(){$(this).find("img").stop().fadeTo("slow",1),$("#image").remove()})),$("#table-sortable tbody").sortable({delay:50,cursor:"move",axis:"y",items:"tr",handle:"td.move",helper:function(e,t){return t.children().each((function(){$(this).width($(this).width())})),t},stop:function(e,t){},start:function(e,t){t.placeholder.outerHeight(t.item.outerHeight())},update:function(){var e=$(this).parent().attr("url"),t=$(this).sortable("toArray");$.post(e,{sort:t},(function(e){toastrSuccess(e.data)}))}})}));var app={confirm:function(e,t,a){a=a||"操作警告",$.messager.confirm(a,t,(function(t){1==t&&(location.href=e)}))},alert:function(e,t){$.messager.alert(e,t)},url:function(e,t){return"/"==e?settings.public_url:(query=""==t||void 0===t?"":"?"+$.param(t),settings.public_url+"/"+e+query)},redirect:function(e,t){return window.location.href=app.url(e,t)},pinyin:function(e,t,a){a=a||"first",""==$("#"+t).val()&&$.get(app.url("index/api/pinyin?type="+a+"&id="+Math.random()),{name:$("#"+e).val()},(function(e){$("#"+t).val(e)}))}},uploader={file:function(e){var t=$("#"+e).find(".id").val();location.href=app.url("index/attachment/download",{id:t})},cancel:function(e){var t=$("#"+e).find(".id").val();if(t>0){var a=$("#"+e).find(".file-name a").text();$.messager.confirm("删除文件","确定要删除 <strong>"+a+"</strong> 此文件吗",(function(a){1==a&&$.get(app.url("index/attachment/delete"),{id:t},(function(t){1==t&&$("#"+e).remove()}))}))}else $("#"+e).remove()},insert:function(e){var t=$("#"+e).find(".id").val(),a=$("#"+e).find(".file-name a").text();if(/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(a))var i='<img src="'+app.url("index/attachment/show",{id:t})+'" title="'+a+'">';else i='<a href="'+app.url("index/attachment/download",{id:t})+'" title="'+a+'">'+a+"</a>";UE.getEditor("content").execCommand("insertHtml",i)}};function mediaDialog(e,t,a,i){var o={id:a,name:t,multi:i};e=app.url(e,o);$.dialog({title:"媒体管理",url:e,dialogClass:"modal-lg",buttons:[{text:'<i class="fa fa-remove"></i> 取消',class:"btn-default",click:function(){$(this).dialog("close")}},{text:'<i class="fa fa-check"></i> 确定',class:"btn-info",click:function(){window.saveMedia&&(window.saveMedia.call(this,o),$(this).dialog("close"))}}]})}function viewBox(e,t,a,i){i=i||"md",$.dialog({title:t,url:a,dialogClass:"modal-"+i,buttons:[{text:"确定",class:"btn-default",click:function(){$(this).dialog("close")}}]})}var viewDialogIndex=0;function viewDialog(e){void 0===e.id&&(e.id="view-dialog-"+viewDialogIndex,viewDialogIndex++);var t=$("#modal-"+e.id);t.length>0&&t.dialog("show");var a={title:name,url,buttons:[{text:"确定",class:"btn-default",click:function(){$(this).dialog("close")}}]},i=$.extend({},a,e);$.dialog(i)}var formDialogIndex=0;function formDialog(e){void 0===e.id&&(e.id="form-dialog-"+formDialogIndex,formDialogIndex++);var t=$("#modal-"+e.id);if(t.length>0)t.dialog("show");else{var a={title:"formDialog",backdrop:"static",buttons:[{text:"取消",class:"btn-default",click:function(){"function"==typeof error?error.call(this):$(this).dialog("close")}},{text:"保存",class:"btn-info",click:function(){var e=this,t=e.options;if("function"==typeof t.onSubmit)t.onSubmit.call(e);else{if(e.options.storeUrl)var a=e.options.storeUrl;else a=$("#"+t.id).attr("action");var i=$("#"+t.id).serialize(),o=gridListData(t.table);if(!1===o)return;var n=showLoading();$.post(a,i+"&"+$.param(o),(function(a){a.status?"function"==typeof t.success&&t.success.call(e,a):"function"==typeof t.error&&t.error.call(e,a)}),"json").complete((function(){layer.close(n)}))}}}]},i=$.extend({},a,e);$.dialog(i)}}function niceTime(e){var t=(new Date).getTime(),a=parseInt((t-1e3*e)/1e3);return a>=0&&a<60?a+"秒前":a>=60&&a<3600?parseInt(a/60)+"分钟前":a>=3600&&a<86400?parseInt(a/3600)+"小时前":parseInt(a/86400)+"天前"}function ucfirst(e){return e?e[0].toUpperCase()+e.substr(1):e}function digitUppercase(e){var t=["角","分"],a=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],i=[["元","万","亿"],["","拾","佰","仟"]],o=e<0?"欠":"";e=Math.abs(e);for(var n="",r=0;r<t.length;r++)n+=(a[Math.floor(10*e*Math.pow(10,r))%10]+t[r]).replace(/零./,"");n=n||"整",e=Math.floor(e);for(r=0;r<i[0].length&&e>0;r++){for(var l="",s=0;s<i[1].length&&e>0;s++)l=a[e%10]+i[1][s]+l,e=Math.floor(e/10);n=l.replace(/(零.)*零$/,"").replace(/^$/,"零")+i[0][r]+n}return o+n.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")}function number_format(e,t,a,i){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var o=isFinite(+e)?+e:0,n=isFinite(+t)?Math.abs(t):0,r=void 0===i?",":i,l=void 0===a?".":a,s="";return(s=(n?function(e,t){if(-1===(""+e).indexOf("e"))return+(Math.round(e+"e+"+t)+"e-"+t);var a=(""+e).split("e"),i="";return+a[1]+t>0&&(i="+"),(+(Math.round(+a[0]+"e"+i+(+a[1]+t))+"e-"+t)).toFixed(t)}(o,n).toString():""+Math.round(o)).split("."))[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,r)),(s[1]||"").length<n&&(s[1]=s[1]||"",s[1]+=new Array(n-s[1].length+1).join("0")),s.join(l)}function isEmpty(e){try{if(""==e||null==e||null==e)return!0;if("number"==typeof e)return!!isNaN(e);if("boolean"==typeof e||"function"==typeof e||e instanceof Date||e instanceof RegExp)return!1;if("string"==typeof e)return 0==e.trim().length;if("object"===_typeof(e)){if(e instanceof Array)return 0==e.length;if(e instanceof Object)return 0==Object.getOwnPropertyNames(e).length}}catch(e){return!1}}function isNotEmpty(e){return!isEmpty(e)}function delHtmlTag(e){return e.replace(/<[^>]+>/g,"")}function isWeiXin(){return"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}function toastrSuccess(e){isWeiXin()?$.toastr("success",e):top.$.toastr("success",e)}function toastrError(e){isWeiXin()?$.toastr("error",e):top.$.toastr("error",e)}function url(e,t){return query=""==t||void 0===t?"":"?"+$.param(t),settings.public_url+"/"+e+query}function format_datetime(e){function t(e){return e<10?"0"+e:e}e=1e3*parseInt(e);var a=new Date(e),i=a.getFullYear(),o=a.getMonth()+1,n=a.getDate(),r=a.getHours(),l=a.getMinutes();a.getSeconds();return i+"-"+t(o)+"-"+t(n)+" "+t(r)+":"+t(l)}function format_date(e){function t(e){return e<10?"0"+e:e}e=1e3*parseInt(e);var a=new Date(e),i=a.getFullYear(),o=a.getMonth()+1,n=a.getDate();a.getHours(),a.getMinutes(),a.getSeconds();return i+"-"+t(o)+"-"+t(n)}function ajaxSubmit(e,t){$("#"+e+"-form-submit").on("click",(function(){var a=$("#"+e),i=a.attr("action"),o=a.serialize(),n={};if(!1!==(n=gridListData(e))){o=o+"&"+$.param(n);var r=showLoading();return $.post(i,o,(function(e){"function"==typeof t?t(e):e.status?(toastrSuccess(e.data),e.url&&(self.location.href=e.url)):toastrError(e.data)}),"json").complete((function(){layer.close(r)})),!1}}))}function getIframeName(){var e=window.name;return e?e.replace("iframe_",""):""}function getIframeDocument(e){if(e){var t=window.frames["iframe_"+e];if(t)return t.document}return null}function showLoading(e){return layer.msg(e||"数据提交中...",{icon:16,shade:.1,time:12e4})}function fileFormatSize(e){return e<1024?e+"B":e<1048576?(e/1024).toFixed(2)+"KB":e<1073741824?(e/1048576).toFixed(2)+"MB":(e/1073741824).toFixed(2)+"GB"}function FindFile(e,t){$.post(app.url("index/attachment/draft"),{key:t},(function(t){var a=[],i="#fileDraft_"+e,o=$(i).find(".id");$.each(o,(function(e,t){a.push($(this).val())})),$.each(t,(function(e,t){if(-1==a.indexOf(t.id+"")){t.size=fileFormatSize(t.size);var o=template("uploader-item-tpl",t);$(i).append(o)}}))}))}function toNumber(e){return e=parseFloat(e),isNaN(e)?0:isFinite(e)?e:0}function StringBuilder(){this._stringArray=new Array}function LocalExport(e,t){if(0!=e.api.getDisplayedRowCount()){var a=[];$.each(e.columnDefs,(function(e,t){1!=t.checkboxSelection&&'"actionCellRenderer"'!=t.cellRenderer&&a.push(t)}));var i=function e(t){var a=[];return $.each(t,(function(t,i){if(null!=i.children){var o=i.children;$.each(e(o),(function(e,t){a.push(t)}))}else a.push(i)})),a}(a),o=function(e){var t=[];return c(e,0,t),t}(a);console.log("开始导出任务:"+t);var n=new StringBuilder,r=o.length-1;$.each(o,(function(e,t){var a=t;n.appendLine('<tr style="font-weight:bold;white-space:nowrap;">'),$.each(a,(function(t,a){var i=toNumber(a.rowspan),o=toNumber(a.colspan);r>e&&null==a.children&&(i+=e+1);var l='<td colspan="'+o+'" rowspan="'+i+'"',s=["text-align:center"];"序号"==a.headerName&&s.push("mso-number-format:'@'"),l=(l=l+' style="'+s.join(";")+'"')+">"+a.headerName+"</td>",n.appendLine(l)})),n.appendLine("</tr>")}));var l=0;e.api.forEachNode((function(e,t){var a=e.data;n.append("<tr>"),l++,$.each(i,(function(e,t){var i;i=null==t.field?"":a[t.field]||"","htmlCellRenderer"==t.cellRenderer&&(i=delHtmlTag(i)),"序号"==t.headerName&&(i=l);var o=[];if("number"==t.type){var r=t.numberOptions||{},s=null==r.places?2:r.places;i=parseFloat(i),i=isNaN(i)?0:i.toFixed(s)}else"date"==t.form_type||o.push("mso-number-format:'@'");n.appendLine('<td style="'+o.join(";")+'">'+i+"</td>")})),n.appendLine("</tr>")})),console.log("结束导出任务:"+t);var s='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Sheet1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body><table>'+n.toString(" ")+"</table></body></html>",d=new Date;!function(e,t){var a=document.createElement("a");a.download=t;var i=new Blob([e]);a.href=URL.createObjectURL(i),document.body.appendChild(a),a.click(),document.body.removeChild(a)}(s,t+"-"+[d.getFullYear(),d.getMonth()+1,d.getDate()].join("-")+".xls")}else toastrError("表格无数据，无法导出.");function c(e,t,a){var i=null;a.length>t?i=a[t]:(i=[],a.push(i)),$.each(e,(function(e,o){var n=o.children;null!=n&&(o.colspan=n.length,c(n,t+1,a)),o.rowspan=1,i.push(o)}))}}function LocalTableExport(e,t){var a=$("#"+e),i=!!a.hasClass("table2excel_with_colors"),o=new Date,n=[o.getFullYear(),o.getMonth()+1,o.getDate()].join("-");a.table2excel({exclude:".noExl",name:t,filename:t+n+".xls",fileext:".xls",exclude_img:!0,exclude_links:!0,exclude_inputs:!0,preserveColors:i})}function regionSelect(){var e=arguments,t={a1:"省",a2:"市",a3:"县"};function a(e,t,a,i){$.get(app.url("index/api/region",{layer:t,parent_id:a}),(function(t){var a="";$.map(t,(function(e){a+='<option value="'+e.id+'">'+e.name+"</option>"}));var o=$("#"+e).html(a);i>0&&o.val(i)}))}$("#"+e[0]).on("change",(function(){a(e[1],2,this.value,0),$("#"+e[1]).html('<option value="">'+t.a2+"</option>"),$("#"+e[2]).html('<option value="">'+t.a3+"</option>")})),$("#"+e[1]).on("change",(function(){a(e[2],3,this.value,0),$("#"+e[2]).html('<option value="">'+t.a3+"</option>")})),a(e[0],1,0,e[3]),e[3]&&(a(e[1],2,e[3],e[4]),e[4]&&a(e[2],3,e[4],e[5]))}String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)},StringBuilder.prototype.append=function(e){this._stringArray.push(e)},StringBuilder.prototype.appendLine=function(e){this._stringArray.push(e+"\n")},StringBuilder.prototype.toString=function(e){return this._stringArray.join(e)};
