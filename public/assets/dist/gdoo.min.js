function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){var i="agDropdownCellEditor",a="ag.dropdown.celleditor",o={maxHeight:200},n=27,r=9,l=37,s=38,d=39,c=40,u=13,p=16,f=function(t,a){this.grid=a.grid,this.config=a.config,this.items=a.data.items,this.selected=a.data.selected,this.hook=a.hook,this.arrow=a.arrow||"icon-search",this.name=a.name,this.onSelect=a.select||function(){},this.$input=e(t),this.settings=e.extend({},o,a),this.init(),e.fn[i].instances.push(this)};e.extend(f.prototype,{init:function(){this._construct(),this._events()},_construct:function(){this.$container=e('<div class="combo-select combo-open combo-'+this.name+'" />'),this.$arrow=e('<div class="combo-arrow"><i class="fa '+this.arrow+'"></i></div>'),this.$dropdown=e('<ul class="combo-dropdown" />').appendTo(this.$container),this._build(),this.$input.after(this.$arrow),e("body").append(this.$container);var t=this.$input.outerHeight(),i=this.$input.outerWidth(),a=this.$input.offset();this.$container.css({width:i+2,left:a.left-1,top:a.top+t+1})},_build:function(){var t=this,i="",a=0;i+='<li class="option-item-empty">无匹配选项</li>',e.each(this.items,(function(e,o){if("optgroup"==o)return i+='<li class="option-group">'+this.label+"</li>";i+='<li class="'+(this.disabled?"option-disabled":"option-item")+" "+(this.id==t.selected?"option-selected":"")+'" data-index="'+a+'" data-value="'+this.id+'">'+this.name+"<i>"+this.code+"</i></li>",a++})),this.$dropdown.html(i),this.$items=this.$dropdown.children()},_events:function(){this.$arrow.off(),this.$container.off(),this.$input.off(),this.$arrow.on("click.arrow",e.proxy(this._toggle,this)),this.$container.on("dropdown:close",e.proxy(this._close,this)),this.$container.on("dropdown:open",e.proxy(this._open,this)),this.$container.on("dropdown:update",e.proxy(this._update,this)),this.$input.on("keydown",e.proxy(this._keydown,this)),this.$input.on("keyup",e.proxy(this._keyup,this)),this.$container.on("click.item",".option-item",e.proxy(this._select,this))},_keydown:function(e){switch(e.which){case n:this.$container.trigger("dropdown:close");break;case s:this._move("up",e),e.stopPropagation();break;case c:this._move("down",e),e.stopPropagation();break;case r:this._enter(e);break;case d:break;case u:this._enter(e)}},_keyup:function(e){switch(e.which){case n:case u:case s:case c:case l:case d:case r:case p:break;default:this._filter(e.target.value)}},_enter:function(e){var t=this._getHovered();this._select(t)},_move:function(e,t){var i=this._getVisible(),a=this._getHovered().prevAll(".option-item").filter(":visible").length,o=i.length;switch(e){case"up":--a<0&&(a=o-1);break;case"down":++a>=o&&(a=0)}i.removeClass("option-hover").eq(a).addClass("option-hover"),this.opened||this.$container.trigger("dropdown:open"),this._fixScroll()},_select:function(t){var i=(t.currentTarget?e(t.currentTarget):e(t)).data("index");this._selectByIndex(i),this.$container.trigger("dropdown:close")},_selectByIndex:function(t){void 0===t&&(t=-1),this._getAll().removeClass("option-selected").filter((function(){return e(this).data("index")==t})).addClass("option-selected"),this._change()},_autofill:function(){var e=this._getHovered();if(e.length){var t=e.data("index");this._selectByIndex(t)}},_filter:function(t){var i=this._getAll(),a=e.trim(t).toLowerCase(),o=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g"),n="("+t.replace(o,"\\$1")+")";e(".combo-marker",i).contents().unwrap(),a?(this.$items.filter(".option-group, .option-disabled").hide(),i.hide().filter((function(){var t=e(this);if(-1!=e.trim(t.text()).toLowerCase().toString().indexOf(a))return t.html((function(e,t){return t.replace(new RegExp(n,"gi"),'<span class="combo-marker">$1</span>')})),!0})).show()):i.show(),this.$container.trigger("dropdown:open"),0==this._getVisible().length?this.$items.filter(".option-item-empty").show():this.$items.filter(".option-item-empty").hide()},_highlight:function(){var e=this._getVisible().removeClass("option-hover"),t=e.filter(".option-selected");t.length?t.addClass("option-hover"):e.removeClass("option-hover").first().addClass("option-hover")},_updateInput:function(){var e=this._getAll().filter(".option-selected").data("index");this.onSelect.call(this,this.items[e])},_focus:function(e){this.$container.toggleClass("combo-focus",!this.opened),this.opened||this.$container.trigger("dropdown:open")},_change:function(){this._updateInput()},_getAll:function(){return this.$items.filter(".option-item")},_getVisible:function(){return this.$items.filter(".option-item").filter(":visible")},_getHovered:function(){return this._getVisible().filter(".option-hover")},_open:function(){var t=this;this.$container.addClass("combo-open"),this.$arrow.addClass("combo-arrow-open"),this.opened=!0,this._highlight(),this._fixScroll(),e.each(e.fn[i].instances,(function(e,i){i!=t&&i.opened&&i.$container.trigger("dropdown:close")}))},_toggle:function(e){this.opened?this._close.call(this):this._open.call(this),this.$input.focus(),e.stopPropagation()},_close:function(){this.$container.removeClass("combo-open combo-focus"),this.$arrow.removeClass("combo-arrow-open"),this.$container.trigger("dropdown:closed"),this.opened=!1,this.$items.filter(".option-item").show()},_fixScroll:function(){if(!this.$dropdown.is(":hidden")){var e=this._getHovered();if(e.length){var t,i,a,o=e.outerHeight();t=e[0].offsetTop,a=(i=this.$dropdown.scrollTop())+this.settings.maxHeight-o,t<i?this.$dropdown.scrollTop(t):t>a&&this.$dropdown.scrollTop(t-this.settings.maxHeight+o)}}},_update:function(){this.$dropdown.empty(),this._build()},dispose:function(){this.$arrow.remove(),this.$input.remove(),this.$dropdown.remove()}}),e.fn[i]=function(t,i){return this.each((function(){var o=e(this).data("plugin_"+a);"string"==typeof t?o&&"function"==typeof o[t]&&o[t](i):(o&&o.dispose&&o.dispose(),e.data(this,"plugin_"+a,new f(this,t)))})),this},e.fn[i].instances=[]}(jQuery),function(e){var t,i=null;function a(t,i){var a=e("#gdoo-gird-suggest");a.is(":visible")&&(a.hide(),t.trigger("onHideDropdown",[i?i.data:[]]))}function o(t,a,o){return function(t,i){var a=e("#gdoo-gird-suggest");a.is(":visible")||(a.show(),t.trigger("onShowDropdown",[i?i.data:[]]))}(t,o),i.remoteParams.q=t.val(),i.remoteData(),t}function n(t,i,a,o){return a=e.trim(a),o.ignorecase&&(t=t.toLocaleLowerCase(),a=a.toLocaleLowerCase()),a&&(function(t,i){var a=i.effectiveFields;return!("__index"===t||a.length&&!~e.inArray(t,a))}(i,o)||function(t,i){return~e.inArray(t,i.searchFields)}(i,o))&&(~a.indexOf(t)||o.twoWayMatch&&~t.indexOf(a))}var r={query:{},item:{},data:[],allowNoKeyword:!0,ignorecase:!1,searchFields:[],twoWayMatch:!0,delay:300,showBtn:!0,clearable:!1,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13,fnGetData:function(e,t,i,a){var o,r,l,s,d=[];if(e=e||"",a.url)i(t,a.data,a);else{if(o=a.data)if(e){for(s=o.length,r=0;r<s;r++)for(l in o[r])if(o[r][l]&&n(e,l,o[r][l]+"",a)){d.push(o[r]),d[d.length-1].__index=r;break}}else d=o;i(t,d,a)}}},l={init:function(n){return n=n||{},n=e.extend(!0,{},r,n),this.each((function(){var r,l,s=e(this),d=s.parent(),c=function(t,i){var a=t.prev("i.clearable");return i.clearable&&!a.length&&(a=e('<i class="clearable glyphicon glyphicon-remove"></i>').prependTo(t.parent())),a.css({position:"absolute",top:12,zIndex:4,cursor:"pointer",fontSize:12}).hide()}(s,n),u=e("#gdoo-gird-suggest");0===u.length&&(u=e('<div class="gdoo-gird-suggest" id="gdoo-gird-suggest" style="position:absolute;display:none;box-shadow:0 2px 5px 0 rgb(0 0 0 / 26%);"></div>'),e("body").append(u)),function(t,o){var n=o.query;n.suggest=!0,e("#gdoo-gird-suggest").html('<div style="height:180px;overflow:auto;width:auto;"><div id="suggest-'+n.id+'" class="ag-theme-balham" style="width:100%;height:180px;border-left:1px solid #BDC3C7;border-right:1px solid #BDC3C7;"></div></div>');var r=gdoo.formKey(n),l=gdoo.event.get(r.key);l.trigger("query",n),l.trigger("open",n),n.prefix;var s=document.querySelector("#suggest-"+n.id);i=new agGridOptions;var d=0!=n.multi;i.remoteDataUrl=app.url(n.url),i.remoteParams=n,i.rowSelection=d?"multiple":"single",i.suppressRowClickSelection=!0,i.columnDefs=[{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"code",headerName:"存货编码",width:100},{suppressMenu:!0,cellClass:"text-left",sortable:!0,field:"name",headerName:"产品名称",minWidth:140},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"spec",headerName:"规格型号",width:100},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"barcode",headerName:"产品条码",width:120},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"unit_id_name",headerName:"计量单位",width:80},{suppressMenu:!0,cellClass:"text-right",field:"price",headerName:"价格",width:80}],i.onRowClicked=function(e){i.dialogSelected(e.data)&&a(t,o)},i.dialogSelected=function(e){var i=!0,a=gdoo.forms[n.form_id],r=a.links[n.id],s=o.item;for(key in 0==query.grid_id&&(query.grid_id=a.lastEditCell.data.id),r)s[key]=e[r[key]];return l.exist("onSelect")&&(i=l.trigger("onSelect",s,e)),a.lastEditCell.data=s,a.api.memoryStore.update(s),t.trigger("onSelect",[s]),a.generatePinnedBottomData(),i},new agGrid.Grid(s,i)}(s,n),s.off(),n.showBtn||(s.css("borderRadius",4),d.css("width","100%").find(".btn:eq(0)").hide()),s.removeClass("disabled").prop("disabled",!1).attr("autocomplete","off"),s.on("keydown",(function(e){u.is(":visible")&&e.keyCode===n.keyEnter&&a(s,n)})).on("compositionstart",(function(e){t=!0})).on("compositionend",(function(e){t=!1})).on("keyup input paste",(function(i){var a;~e.inArray(i.keyCode,[n.keyDown,n.keyUp,n.keyEnter])?s.val(s.val()):(clearTimeout(l),l=setTimeout((function(){t||(a=s.val(),e.trim(a)&&a===function(e,t){return void 0!==t?e.attr("alt",t):e.attr("alt")}(s)||(a.length||n.allowNoKeyword)&&n.fnGetData(e.trim(a),s,o,n))}),n.delay||300))})).on("blur",(function(){r||a(s,n)})).on("focus",(function(){u.off();var t=e(window).width(),i=e(window).height(),a=s.outerWidth(),o=s.outerHeight(),n=s.offset(),l=u.outerWidth(),d=u.outerHeight(),c={top:n.top+o};t<768?(c.minWidth=360,c.left=14,c.right=14):(c.left=n.left-1,t<n.left+l+10&&(c.left=n.left-l+a+1),i<n.top+d+10&&(c.top=n.top-d)),u.css(c),u.on("mouseenter",(function(){r=1,s.blur()})).on("mouseleave",(function(){r=0,s.focus()})).on("click",(function(){return!1}))})),c.length&&(c.click((function(){})),d.mouseenter((function(){s.prop("disabled")||c.css("right",n.showBtn?Math.max(s.next(".input-group-btn").width(),33)+2:12).show()})).mouseleave((function(){c.hide()})))}))},show:function(){return this.each((function(){e(this).click()}))},hide:function(){return this.each((function(){a(e(this))}))},disable:function(){return this.each((function(){e(this).attr("disabled",!0).parent().find(".btn:eq(0)").prop("disabled",!0)}))},enable:function(){return this.each((function(){e(this).attr("disabled",!1).parent().find(".btn:eq(0)").prop("disabled",!1)}))},destroy:function(){return this.each((function(){e(this).off().removeData("gdooSuggest").removeAttr("style").parent().find(".btn:eq(0)").off().show().attr("data-toggle","dropdown").prop("disabled",!1).next().css("display","").off()}))}};e.fn.gdooSuggest=function(t){if("string"==typeof t&&l[t]){var i=!0;return this.each((function(){if(!e(this).data("gdooSuggest"))return i=!1})),i||"init"===t||"version"===t?l[t].apply(this,[].slice.call(arguments,1)):this}return l.init.apply(this,arguments)}}(jQuery);var formGridList={};function gridForms(e,t,i){i.master=e;var a=gridForm(t,i);return formGridList[e].push(a),a}function gridForm(e,t){t=$.extend({heightTop:70,data:[],dataType:"local"},t);var i=new agGridOptions;i.suppressLoadingOverlay=!0,i.suppressNoRowsOverlay=!0,i.rowMultiSelectWithClick=!1,i.singleClickEdit=!0,i.rowSelection="single",i.suppressCellSelection=!1,i.suppressRowClickSelection=!1,i.columnDefs=t.columns,i.links=t.links,i.tableTitle=t.title,i.tableKey=t.table,i.defaultColDef.sortable=!1,i.defaultColDef.filter=!1,i.defaultColDef.suppressMenu=!0,i.defaultColDef.suppressNavigable=!0,i.isEditing=!1,i.isEditingDialog=!1;var a=gdoo.event.get("grid."+e),o=a.args.editable||{};i.defaultColDef.editable=function(e){if(e.node.rowPinned)return!1;var t=e.colDef,a=o[t.field];return"function"==typeof a?a.call(i,e):!!e.colDef._editable},i.getRowNodeId=function(e){if(e.id)return e.id},i.onRowClicked=function(e){},i.stopEditingWhenGridLosesFocus=!1,i.onRowDoubleClicked=function(e){},i.onCellEditingStarted=function(e){i.lastEditCell=e,i.isEditingDialog="dialogCellEditor"==e.colDef.cellEditor,i.isEditing=!0},i.onCellEditingStopped=function(){i.isEditing=!1,i.isEditingDialog&&$("#gdoo-gird-suggest").hide()};var n=!1,r=document.querySelector("#grid_"+e);""==r.style.height&&(n=!0,r.style.height=s()+"px"),a.trigger("init",i),new agGrid.Grid(r,i),i.api.dialogSelected=function(e,a){var o=gdoo.event.get(e.form_id+"."+e.id),n=t.links[e.id],r=i.api.memoryStore,l=[];i.api.forEachNode((function(t,i){null==t.data[e.id]&&l.push(t.data)})),0==e.grid_id&&(e.grid_id=i.lastEditCell.data.id);for(var s=0;s<a.length;s++){var d=l[s],c=!0;if(null==d&&(d={},c=!1),1==a.length){var u=i.api.getSelectedRows();if(0==u.length){if(d={},e.grid_id)d=i.api.getRowNode(e.grid_id).data,c=!0}else e.grid_id&&(d=u[0],c=!0)}var p=a[s];for(key in n)d[key]=p[n[key]];o.trigger("onSelect",d,p),c?r.update(d):r.create(d),1==a.length&&e.grid_id&&$("#"+e.name+"_"+e.grid_id).val(d[e.name])}i.generatePinnedBottomData()},i.api.memoryStore={lastIndex:1,created:[],updated:[],deleted:[],create:function(e,t){this.lastIndex++,e.id="draft_"+this.lastIndex,e=i.calcRow(e),this.created.push(e),i.api.updateRowData({add:[e],addIndex:t})},update:function(e){e=i.calcRow(e),this.updated.push(e),i.api.updateRowData({update:[e]})},delete:function(e,t){0==t&&this.deleted.push(e),this.created=this.created.filter((function(t){return t.id!=e.id})),this.updated=this.updated.filter((function(t){return t.id!=e.id}));i.api.updateRowData({remove:[e]});i.generatePinnedBottomData()}},i.onFirstDataRendered=function(e){this.api;this.generatePinnedBottomData()},i.calcRow=function(e,i){for(var a=0;a<t.columns.length;a++){var o=t.columns[a];if(o.calcRow){var n=new Function("data","column",o.calcRow),r=parseFloat(n(e,i||{}));(isNaN(r)||0===r)&&(r=""),e[o.field]=r}}return e},i.onCellValueChanged=function(e){var t=this;if(e.oldValue!=e.newValue){var i=e.data;i=t.calcRow(i,e.column),t.api.updateRowData({update:[i]}),t.generatePinnedBottomData()}},"local"==t.dataType&&(t.data.length>0?("function"==typeof a.dataLoaded&&a.dataLoaded.call(i,t.data),i.api.updateRowData({add:t.data})):i.api.memoryStore.create({})),i.api.deleteRow=function(e){var t=i.api.getRowNode(e.id).data;0===(""+t.id).indexOf("draft_")?i.api.memoryStore.delete(t,!0):i.api.memoryStore.delete(t,!1)};var l=$(r);function s(){var e=$("#tab-content-"+t.master).position(),i=$(window).height()-e.top-t.heightTop;return i>320?i:320}return l.off(),l.on("click",'[data-toggle="event"]',(function(){var e=$(this).data();"option"==e.action&&("add"==e.type?i.api.memoryStore.create({}):i.api.getDisplayedRowCount()>1&&i.api.deleteRow(e))})),l.on("blur",".ag-input-wrapper",(function(){i.isEditingDialog||i.isEditing&&i.api.stopEditing()})),i.onGridReady=function(e){a.trigger("ready",i),n&&window.addEventListener("resize",(function(){setTimeout((function(){r.style.height=s()+"px"}))}))},gdoo.forms[e]=i,i}function getPanelHeight(e){return"calc(100vh - "+($(".gdoo-list-grid").position().top+e+"px")+")"}!function(e,t){var i={page:"页",more:"更多",to:"到",of:"至",next:"下一页",last:"上一页",first:"首页",previous:"上一页",loadingOoo:"加载中...",selectAll:"查询全部",searchOoo:"查询...",blanks:"空白",filterOoo:"过滤...",applyFilter:"daApplyFilter...",equals:"相等",notEqual:"不相等",lessThan:"小于",greaterThan:"大于",lessThanOrEqual:"小于等于",greaterThanOrEqual:"大于等于",inRange:"范围",contains:"包含",notContains:"不包含",startsWith:"开始于",endsWith:"结束于",group:"组",columns:"列",filters:"筛选",rowGroupColumns:"laPivot Cols",rowGroupColumnsEmptyMessage:"la drag cols to group",valueColumns:"laValue Cols",pivotMode:"laPivot-Mode",groups:"laGroups",values:"值",pivots:"laPivots",valueColumnsEmptyMessage:"la drag cols to aggregate",pivotColumnsEmptyMessage:"la drag here to pivot",toolPanelButton:"la tool panel",noRowsToShow:"数据为空",pinColumn:"laPin Column",groupBy:"排序",ungroupBy:"不排序",resetColumns:"重置列",expandAll:"展开全部",collapseAll:"关闭",toolPanel:"工具面板",export:"导出",csvExport:"导出为CSV格式文件",excelExport:"导出到Excel",sum:"总数",min:"最小值",max:"最大值",none:"无",count:"总",average:"平均值",copy:"复制",copyWithHeaders:"携带表头复制",ctrlC:"ctrl + C",paste:"粘贴",ctrlV:"ctrl + V"};function a(){}function o(){}function n(){}function r(){}function l(){}function s(){}function d(){}function c(){}a.prototype.init=function(e){e.node.rowPinned||(this.eGui=document.createElement("div"),this.eGui.className="options",this.eGui.innerHTML='<a data-toggle="event" data-action="option" data-type="add" data-index="'+e.rowIndex+'" data-id="'+e.data.id+'" class="fa fa-plus" title="新增行"></a>  <a data-toggle="event" data-action="option" data-type="delete" data-id="'+e.data.id+'" data-index="'+e.rowIndex+'" class="fa fa-times" title="删除行"></a></div>')},a.prototype.getGui=function(){return this.eGui},o.prototype.init=function(e){this.eGui=document.createElement("span"),this.eGui.innerHTML=e.value||""},o.prototype.getGui=function(){return this.eGui},n.prototype.init=function(e){var t=e.api.gridCore.gridOptions;if(!e.node.rowPinned&&null!=e.data){var i=e.data,a="";i.master_id>0&&e.colDef.options.forEach((function(e){if(e.display){var o='<a data-toggle="event" class="option" data-action="'+e.action+'" data-master_name="'+i.name+'"  data-master_id="'+i.master_id+'" href="javascript:;">'+e.name+"</a>";a+=t.actionCellBeforeRender(o,e,i)||""}})),this.eGui=document.createElement("span"),this.eGui.innerHTML=a}},n.prototype.getGui=function(){return this.eGui},r.prototype.init=function(e){this.grid=e,this.selectedKey=null,this.items=e.colDef.cellEditorParams.values,this.eInput=document.createElement("input"),this.eInput.value=e.value||"",this.eInput.className="ag-cell-edit-input form-control"},r.prototype.getGui=function(e){return this.eInput},r.prototype.afterGuiAttached=function(){var e=this,i=e.grid,a=e.eInput.value;t(e.eInput).agDropdownCellEditor({grid:e,arrow:"fa-caret-down",data:{items:e.items,selected:i.data[i.select_key]},select:function(t){t?(i.data[i.select_key]=t.id,e.eInput.value=t.name,e.selectedKey=t.id):e.eInput.value=a,i.stopEditing()}}),e.eInput.focus(),e.eInput.select()},r.prototype.getValue=function(){return this.eInput.value},r.prototype.destroy=function(){t("body").find(".combo-select").remove()},l.prototype.init=function(e){var t=e.value,i=e.colDef.cellEditorParams.values;this.eGui=document.createElement("div"),this.eGui.innerHTML=i[t]||i[0]},l.prototype.getGui=function(){return this.eGui},s.prototype.init=function(e){var t=e.value;this.eInput=document.createElement("input"),this.eInput.type="checkbox",this.eInput.checked=t,this.eInput.value=t},s.prototype.getGui=function(e){return this.eInput},s.prototype.afterGuiAttached=function(){this.eInput.focus(),this.eInput.select()},s.prototype.getValue=function(){return this.eInput.checked?1:0},s.prototype.destroy=function(){},d.prototype.init=function(e){this.params=e,this.eInput=document.createElement("div"),this.eInput.tabIndex="-1";var i=e.colDef.field+"_"+e.data.id,a=e.query;a.multi=1,a.is_grid=1,a.url=e.url,a.grid_id=e.data.id,a.title=e.title;var o="";t.each(a,(function(e,t){o+=" data-"+e+'="'+t+'"'})),this.query=a,this.eInput.innerHTML='<input class="ag-cell-edit-input" value="'+(e.value||"")+'" id="'+i+'"><a class="combo-arrow" data-toggle="dialog-view" '+o+'><i class="fa fa-search"></i></a>',this.eInput.className="ag-input-wrapper ag-input-dialog-wrapper"},d.prototype.getGui=function(e){return this.eInput},d.prototype.afterGuiAttached=function(){var e=this;t(e.eInput).find("input").gdooSuggest({item:e.params.data,query:e.query}).on("onSelect",(function(t,i){e.params.data[e.query.name]=i[e.query.name],e.eInput.querySelector("input").value=i[e.query.name]})),e.eInput.querySelector("input").select()},d.prototype.getValue=function(){return this.params.data[this.params.query.name]},d.prototype.destroy=function(){t(this.eInput).find("input").off()},d.prototype.isPopup=function(){return!1},c.prototype.init=function(e){this.params=e.colDef.cellEditorParams,this.eInput=document.createElement("div"),this.eInput.innerHTML='<input type="text" class="ag-cell-edit-input" data-toggle="date" value="'+(e.value||"")+'">',this.eInput.className="ag-input-wrapper ag-input-date-wrapper"},c.prototype.getGui=function(e){return this.eInput},c.prototype.afterGuiAttached=function(){this.eInput.querySelector("input").click()},c.prototype.getValue=function(){return this.eInput.querySelector("input").value},c.prototype.destroy=function(){},e.agGridOptions=function(){var e={defaultColDef:{minWidth:100,enableRowGroup:!0,enablePivot:!0,enableValue:!0,sortable:!0,resizable:!0,filter:!0,comparator:function(e,t){return"htmlCellRenderer"==this.cellRenderer?(e=delHtmlTag(e),t=delHtmlTag(t),e.localeCompare(t)):"string"==typeof e?e.localeCompare(t):e>t?1:e<t?-1:0}},pinnedBottomRowData:[],rowDragManaged:!0,suppressRowClickSelection:!0,rowMultiSelectWithClick:!1,rowSelection:"multiple",localeText:i,suppressAnimationFrame:!0,suppressContextMenu:!0,suppressPropertyNamesCheck:!0,suppressCellSelection:!0,enableCellTextSelection:!0,remoteDataUrl:"",remoteParams:{},dialogList:{},editableList:{},autoColumnsToFit:!0,lastEditCell:{},selectedRows:[],pager:!1,pagerDom:null,pagePer:50,numberEmptyDefaultValue:!1,pageList:[50,100,500,1e3,2e3,5e3,1e4,2e4,5e4],onCellEditingStarted:function(e){this.lastEditCell=e},remoteBeforeSuccess:function(){},remoteAfterSuccess:function(){},onGridSizeChanged:function(){},onGridReady:function(){},onFirstDataRendered:function(e){var t=this,i=t.api;t.autoColumnsToFit&&i.sizeColumnsToFit(),"function"==typeof t.onCustomFirstDataRendered&&t.onCustomFirstDataRendered.call(t,e),t.generatePinnedBottomData()},onCellValueChanged:function(e){this.generatePinnedBottomData()},getRowStyle:function(e){},onRowClicked:function(e){!1===e.node.isSelected()&&e.node.setSelected(!0,!0)},getSelectedRows:function(){return this.selectedRows},onRowSelected:function(e){var t=this,i=e.node;if(i.selected)t.selectedRows.push(i.data);else for(var a=0;a<t.selectedRows.length;a++){var o=t.selectedRows[a];i.data.id==o.id&&t.selectedRows.splice(a,1)}},columnTypes:{number:{cellClass:"ag-cell-number",valueFormatter:function(t){if(t.node.rowPinned&&!t.colDef.calcFooter)return"";var i=t.colDef.numberOptions||{},a=null==i.places?2:i.places,o=null==i.separator?".":i.separator,n=null==i.thousands?",":i.thousands,r=null==i.default?0:i.default,l=parseFloat(t.value);return isNaN(l)||0==l?0==e.numberEmptyDefaultValue?r:"":l=number_format(l,a,o,n)},valueParser:function(e){var t=parseFloat(e.newValue);return isNaN(t)?0:t}},sn:{cellClass:"ag-cell-sn",valueFormatter:function(e){return e.node.rowPinned?"":parseInt(e.node.childIndex)+1},valueParser:function(e){return parseFloat(e.newValue)}},datetime:{cellClass:"ag-cell-datetime",valueFormatter:function(e){return e.node.rowPinned?"":format_datetime(e.value)},valueParser:function(e){return parseFloat(e.newValue)}},date:{cellClass:"ag-cell-date",valueFormatter:function(e){return e.node.rowPinned?"":format_date(e.value)},valueParser:function(e){return parseFloat(e.newValue)}}},components:{optionCellRenderer:a,actionCellRenderer:n,htmlCellRenderer:o,selectCellEditor:r,dialogCellEditor:d,dateCellEditor:c,checkboxCellEditor:s,checkboxCellRenderer:l},overlayLoadingTemplate:'<span class="ag-overlay-loading-center">数据加载中...</span>',overlayNoRowsTemplate:'<div style="padding-top:20px;"><img alt="暂无数据" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAxKSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgIDxlbGxpcHNlIGZpbGw9IiNGNUY1RjUiIGN4PSIzMiIgY3k9IjMzIiByeD0iMzIiIHJ5PSI3Ii8+CiAgICA8ZyBmaWxsLXJ1bGU9Im5vbnplcm8iIHN0cm9rZT0iI0Q5RDlEOSI+CiAgICAgIDxwYXRoIGQ9Ik01NSAxMi43Nkw0NC44NTQgMS4yNThDNDQuMzY3LjQ3NCA0My42NTYgMCA0Mi45MDcgMEgyMS4wOTNjLS43NDkgMC0xLjQ2LjQ3NC0xLjk0NyAxLjI1N0w5IDEyLjc2MVYyMmg0NnYtOS4yNHoiLz4KICAgICAgPHBhdGggZD0iTTQxLjYxMyAxNS45MzFjMC0xLjYwNS45OTQtMi45MyAyLjIyNy0yLjkzMUg1NXYxOC4xMzdDNTUgMzMuMjYgNTMuNjggMzUgNTIuMDUgMzVoLTQwLjFDMTAuMzIgMzUgOSAzMy4yNTkgOSAzMS4xMzdWMTNoMTEuMTZjMS4yMzMgMCAyLjIyNyAxLjMyMyAyLjIyNyAyLjkyOHYuMDIyYzAgMS42MDUgMS4wMDUgMi45MDEgMi4yMzcgMi45MDFoMTQuNzUyYzEuMjMyIDAgMi4yMzctMS4zMDggMi4yMzctMi45MTN2LS4wMDd6IiBmaWxsPSIjRkFGQUZBIi8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"><div style="padding-top:5px;color:#999;">暂无数据</div></div>',generatePinnedBottomData:function(){var t=this,i={},a=!1;e.columnApi.getAllGridColumns().forEach((function(e){e.colDef.calcFooter&&(a=!0,i[e.colId]=t.calculatePinnedBottomData(e))})),a&&t.api.setPinnedBottomRowData([i])},calculatePinnedBottomData:function(t){var i=0;return e.api.forEachNode((function(e){i+=toNumber(e.data[t.colId])})),0==i?"":i},actionCellBeforeRender:function(e,t,i){return e},remoteData:function(i,a){var o=this,n=e.remoteParams;for(var r in i)n[r]=i[r];e.api.showLoadingOverlay(),t.post(e.remoteDataUrl,n,(function(i){if(e.remoteBeforeSuccess.call(e,i),"function"==typeof a&&a(i),i.per_page)if(null===o.pagerDom){var n=o.api.gridCore.eGridDiv,r=n.id+"-pager";t(n).after('<div id="'+r+'" class="ag-pager"></div>'),o.pagerDom=t("#"+r).Paging({pagesize:i.per_page,count:i.total,current:i.current_page,pageSizeList:[50,100,500,1e3,2e3,5e3,1e4,2e4,5e4],callback:function(e,t,i){o.remoteData2({page:e,limit:t})}})}else o.pagerDom[0].render({pagesize:i.per_page,count:i.total,current:i.current_page});e.api.hideOverlay(),e.api.setRowData(i.data),e.generatePinnedBottomData(),e.remoteAfterSuccess.call(e,i)}),"json")},remoteData2:function(i,a){var o=e.remoteParams;for(var n in i)o[n]=i[n];e.api.showLoadingOverlay(),t.post(e.remoteDataUrl,o,(function(t){e.remoteBeforeSuccess.call(e,t),"function"==typeof a&&a(t),e.api.hideOverlay(),e.api.setRowData(t.data),e.generatePinnedBottomData(),e.remoteAfterSuccess.call(e,t)}),"json")}};return e}}(window,jQuery),function(e){var t=function(e){var t=this;t.args=e,t.trigger=function(e){if("function"==typeof t.args[e]){for(var i=[],a=1;a<arguments.length;a++)i.push(arguments[a]);return t.args[e].apply(t,i)}},t.exist=function(e){return"function"==typeof t.args[e]}},i={formKey:function(e){if(e.form_id)var t=e.form_id+"."+e.id,i=e.form_id+"_"+e.id,a=e.form_id+"_"+e.name;else t=e.id,i=e.id,a=e.name;return{id:i,key:t,name:a}},widgets:{},forms:{},dialogs:{},grids:{},event:{events:{},set:function(e,i){this.events[e]=new t(i)},get:function(e){return this.events[e]||new t({})}},dialogInit:function(t,a){var o=i.formKey(t),n=i.event.get(o.key);n.trigger("query",t);var r=!0;document.onkeydown=function(e){17==(e=e||window.event).keyCode&&(r=!1)},document.onkeyup=function(e){17==(e=e||window.event).keyCode&&(r=!0)};var l=0!=t.multi;return a.suppressRowClickSelection=!0,a.rowSelection=l?"multiple":"single",a.multiple=l,a.onRowClicked=function(e){var t=e.node.isSelected();l?(!1===t&&e.node.setSelected(!0,r),!0===t&&!1===r&&e.node.setSelected(!1,!1)):!1===t&&e.node.setSelected(!0,!0)},a.onRowSelected=function(e){if(t.is_grid);else{var i=1==t.prefix?"sid":"id",a=dialogCacheSelected[o.id];e.node.isSelected()?a[e.data[i]]=e.data.name:delete a[e.data[i]],dialogCacheSelected[o.id]=a}},a.onRowDoubleClicked=function(){1==i.dialogSelected(n,t,o,a)&&e("#gdoo-dialog-"+t.dialog_index).dialog("close")},a.remoteAfterSuccess=function(){i.dialogInitSelected(t,o,a)},i.dialogs[o.id]=a,o},dialogSelected:function(t,a,o,n){var r=n.api.getSelectedRows();if(a.is_grid){i.forms[a.form_id].api.dialogSelected(a,r)}else{var l=1==a.prefix?"sid":"id",s=0!=a.multi,d=getIframeDocument(a.iframe_id);if(d)var c=e("#"+o.id,d),u=e("#"+o.id+"_text",d);else c=e("#"+o.id),u=e("#"+o.id+"_text");var p=dialogCacheSelected[o.id]||{};if(e.each(r,(function(e,t){p[t[l]]=t.name})),c.val(Object.keys(p).join(",")),u.val(Object.values(p).join(",")),t.exist("onSelect"))return t.trigger("onSelect",s?r:r[0])}return!0},dialogInitSelected:function(t,i,a){if(t.is_grid);else{var o=1==t.prefix?"sid":"id",n=getIframeDocument(t.iframe_id);if(n)var r=e("#"+i.id,n),l=e("#"+i.id+"_text",n);else r=e("#"+i.id),l=e("#"+i.id+"_text");if(t.is_org)var s=dialogCacheSelected[i.id];else{var d=r.val(),c=l.val();s={};if(d)for(var u=d.split(","),p=c.split(","),f=0;f<u.length;f++)s[u[f]]=p[f];dialogCacheSelected[i.id]=s}a.api.forEachNode((function(e){var t=e.data[o];null!=s[t]&&e.setSelected(!0)}))}},grid:function(t){var a=this;this.table=t,this.grid=new agGridOptions,this.header=Vue.reactive({init:!1,name:"",master_table:"",access:{},create_btn:!1,trash_btn:!1,simple_search_form:!0,right_buttons:[],left_buttons:[],buttons:[],tabs:{items:[],active:""},search_form:{columns:[]},by_title:"全部",bys:{items:[]}}),this.search={simple:{el:null,query:{}},advanced:{el:null,query:{}}},this.action=new gridAction,this.grid.autoColumnsToFit=!1,this.grid.onRowDoubleClicked=function(e){e.node.rowPinned||null!=e.data&&e.data.master_id>0&&a.action.rowDoubleClick&&a.action.rowDoubleClick(e.data)},this.div=function(t){var i=document.querySelector("#"+this.table+"-grid");return i.style.height=this.getPanelHeight(t),new agGrid.Grid(i,this.grid),e(i).on("click",'[data-toggle="event"]',(function(){var t=e(this).data();t.master_id>0&&a.action[t.action](t)})),i},this.getPanelHeight=function(t){return"calc(100vh - "+(e(".gdoo-list-grid").position().top+t+"px")+")"},this.init=function(i){var a=this;if(0==a.header.init){var o=i.header;a.header.init=!0,a.header.create_btn=o.create_btn,a.header.trash_btn=o.trash_btn,a.header.name=o.name,a.header.table=t;var n=o.search_form;n.simple_search=o.simple_search_form,a.header.search_form=n,a.search.forms=n.forms,a.action.table=t,a.action.name=o.master_name,a.action.bill_url=o.bill_uri,o.access&&(a.header.access=o.access),o.right_buttons&&(a.header.right_buttons=o.right_buttons),o.left_buttons&&(a.header.left_buttons=o.left_buttons),o.buttons&&(a.header.center_buttons=o.buttons),o.bys&&(a.header.bys=o.bys),o.tabs&&(a.header.tabs=o.tabs,a.header.tabs.active=n.params.tab?n.params.tab:o.tabs.items[0].value),a.grid.api.setColumnDefs(o.columns),a.grid.columnDefs=o.columns,a.grid.remoteParams=n.query,e("#"+t+"-page").show(),setTimeout((function(){a.searchForm()}),1)}},this.searchForm=function(){var t=this;t.search.advanced.el=e("#"+t.table+"-search-form-advanced").searchForm({data:t.search.forms,advanced:!0}),t.search.simple.el=e("#"+t.table+"-search-form").searchForm({data:t.search.forms}),t.search.simple.el.find("#search-submit").on("click",(function(){var i=t.search.simple.el.serializeArray(),a={};return t.search.queryType="simple",e.map(i,(function(e){a[e.name]=e.value})),a.page=1,t.grid.remoteData(a),!1}))},this.setup={header:this.header,action:this.action,grid:this.grid},i.grids[t]={grid:this.grid,search:this.search}}};window.gdoo=i}(jQuery);var select2List={};!function(e){e.fn.select2Field=function(t){$this=e(this);var i=$this.attr("key"),a=gdoo.event.get(i),o={width:"100%",placeholder:" - ",allowClear:!0,minimumInputLength:0,resultCache:!0,ajax:{type:"POST",url:"",dataType:"json",delay:250,cache:!1,data:function(e){var i=t.ajaxParams||{};return i.q=e.term||"",i.page=e.page||1,i.resultCache=!0,a.trigger("query",i),i},processResults:function(e,t){return{results:e.data,pagination:{more:e.current_page<e.last_page}}}},escapeMarkup:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},createTag:function(t){var i=e.trim(t.term);return""===i?null:{id:"draft_"+i,text:i}},initSelection:function(e,t){t({id:e.val(),text:e.text()})}};t=e.extend(!0,{},o,t),a.trigger("init",t);var n=$this.select2(t);return n.on("select2:select",(function(e){a.trigger("onSelect",e.params.data)})),n.on("select2:opening",(function(){})),n.on("select2:open",(function(){})),n}}(jQuery),function(e){"use strict";var t=null,i={query:{},item:{},data:[],delay:300,showBtn:!0,clearable:!1,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13};function a(t,i){var a=e("#gdoo-suggest");a.is(":visible")&&(a.hide(),t.trigger("onHideSuggest",[i?i.data:[]]))}function o(i,a,o){!function(t,i){var a=e("#gdoo-suggest");a.is(":visible")||(a.show(),t.trigger("onShowSuggest",[i?i.data:[]]))}(i,a);var n=gdoo.event.get(o.form_id+"."+o.id);return n.trigger("open",o),n.trigger("query",o),o.suggest=!0,o.q=i.val(),t.rowSelection=1==o.multi?"multiple":"single",t.remoteDataUrl=app.url(o.url),t.remoteParams=o,t.remoteData(),i}e.fn.gdooDialogInput=function(n){return n=n||{},n=e.extend(!0,{},i,n),e("body").append('<div class="gdoo-gird-suggest" id="gdoo-suggest" style="position:absolute;display:none;box-shadow:0 2px 5px 0 rgb(0 0 0 / 26%);"></div>'),this.each((function(){var i=e(this),r=i.data(),l=null,s=0,d=e("#gdoo-suggest");!function(i,o,n){e("#gdoo-suggest").html('<div style="height:180px;overflow:auto;width:auto;"><div id="suggest-aggrid" class="ag-theme-balham" style="width:100%;height:180px;border-left:1px solid #BDC3C7;border-right:1px solid #BDC3C7;"></div></div>');var r=document.querySelector("#suggest-aggrid");(t=new agGridOptions).suppressRowClickSelection=!0,t.columnDefs=[{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"code",headerName:"存货编码",width:100},{suppressMenu:!0,cellClass:"text-left",sortable:!0,field:"name",headerName:"产品名称",minWidth:140},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"spec",headerName:"规格型号",width:100},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"barcode",headerName:"产品条码",width:120},{suppressMenu:!0,cellClass:"text-center",sortable:!0,field:"unit_id_name",headerName:"计量单位",width:80},{suppressMenu:!0,cellClass:"text-right",field:"price",headerName:"价格",width:80}],t.onRowClicked=function(e){t.dialogSelected([e.data])&&a(i,o)},t.dialogSelected=function(i){var a=t.remoteParams,o=1==a.prefix?"sid":"id",n=[],r=[];e.each(i,(function(e,t){n.push(t[o]),r.push(t.name)}));var l=a.form_id+"_"+a.id;e("#"+l).val(n.join(",")),e("#"+l+"_text").val(r.join(","));var s=gdoo.event.get(a.form_id+"."+a.id);return!s.exist("onSelect")||s.trigger("onSelect","multiple"==t.rowSelection?i:i[0])},new agGrid.Grid(r,t)}(i,n),i.off(),i.on("keydown",(function(e){d.is(":visible")&&e.keyCode===n.keyEnter&&a(i,n)})).on("keyup input paste",(function(t){~e.inArray(t.keyCode,[n.keyDown,n.keyUp,n.keyEnter])?i.val(i.val()):(clearTimeout(l),l=setTimeout((function(){o(i,n,r)}),n.delay))})).on("focus",(function(){d.off();var t=e(window).width(),a=e(window).height(),o=i.outerWidth(),n=i.outerHeight(),r=i.offset(),l=d.outerWidth(),c=d.outerHeight(),u={top:r.top+n-1};t<768?(u.minWidth=360,u.left=14,u.right=14):(u.left=r.left,t<r.left+l+10&&(u.left=r.left-l+o),a<r.top+c+10&&(u.top=r.top-c+1)),d.css(u),d.on("mouseenter",(function(){s=1,i.blur()})).on("mouseleave",(function(){s=0,i.focus()})).on("click",(function(){return!1}))})).on("blur",(function(){s||a(i,n)}))}))}}(jQuery),function(e){"use strict";e.fn.searchForm=function(t){var i=this,a=[],o=t.data,n=1==t.advanced||1==o.advanced?1:0,r=i.attr("id"),l=!1,s="search-field-",d="search-condition-",c="search-value-";function u(t,n,r){i.find("#"+c+n),a[n]={condition:i.find("#"+d+n),value:i.find("#"+c+n)},function(t,i,o){var n=a[t].condition.empty(),r={};1==l&&(o="");if(r.number=[{key:"eq",value:"等于"},{key:"neq",value:"不等于"},{key:"gt",value:"大于"},{key:"lt",value:"小于"}],r.date=[{key:"eq",value:"等于"},{key:"neq",value:"不等于"},{key:"gt",value:"大于"},{key:"lt",value:"小于"}],r.second=[{key:"eq",value:"等于"},{key:"neq",value:"不等于"},{key:"gt",value:"大于"},{key:"lt",value:"小于"}],r.text=[{key:"like",value:"包含"},{key:"not_like",value:"不包含"},{key:"eq",value:"等于"},{key:"neq",value:"不等于"},{key:"gt",value:"大于"},{key:"lt",value:"小于"},{key:"empty",value:"为空"},{key:"not_empty",value:"不为空"}],"second"==i||"text"==i||"number"==i||"date"==i){var s=o||r[i][0].key;e.map(r[i],(function(e){n.append('<option value="'+e.key+'">'+e.value+"</option>")})),n.parent("div").css("display","inline-block")}else if("birthday"==i){n.append('<option value="birthday">birthday</option>'),n.parent("div").hide();s="birthday"}else if("date2"==i){n.append('<option value="date2">date2</option>'),n.parent("div").hide();s="date2"}else if("region"==i){n.append('<option value="region">region</option>'),n.parent("div").hide();s="region"}else if("second2"==i){n.append('<option value="second2">second2</option>'),n.parent("div").hide();s="second2"}else if("dialog"==i){n.append('<option value="dialog">dialog</option>'),n.parent("div").hide();s="dialog"}else{n.append('<option value="eq">eq</option>'),n.parent("div").hide();s="eq"}n.val(s),p(t,s),n.on("change",(function(){p(t,e(this).val())}))}(n,t,o.condition[n]||""),g[t].call(i,n,r)}function p(e,t){var i=a[e].value;"empty"==t||"not_empty"==t?i.hide():i.show()}function f(e,t){var i=c,a={},n="",s="";if(null!=t&&(n="-"+t,s="_"+t),a.id=r+"_"+i+e+n,a.name="search_"+e+s,0==l)if(n){var d=o.search[e][t];a.value=null==d?"":d}else{d=o.search[e];a.value=null==d?"":d}else a.value="";return a}n&&(s="advanced-"+s,d="advanced-"+d,c="advanced-"+c),i._select=function(t,i,o,r){var l,s,d,c=f(i,o),u=(l=t,s=e.type(l),d=1==n?'<option value=""> - </option>':"","array"==s||"object"==s?e.map(l,(function(e){d+='<option value="'+e.id+'">'+e.name+"</option>"})):d=d.concat(l),d),p=e('<select name="'+c.name+'" id="'+c.id+'" class="form-control input-sm">'+u+"</select>");a[i].value.append(p),""!==c.value&&p.val(c.value)},i._text=function(t,i,o){var n=f(t,i),r=e('<input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" class="form-control input-sm">');a[t].value.append(r)},i._year=function(t,i,o){var n=f(t,i),r=e('<input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" autocomplete="off" data-toggle="date" data-format="yyyy" class="form-control input-sm">');a[t].value.append(r)},i._date=function(t,i,o){var n=f(t,i),r=e('<input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" autocomplete="off" data-toggle="date" class="form-control input-sm">');a[t].value.append(r)},i._date2=function(t,i,o){var n=f(t,0),r=f(t,1),l=e('<table class="table date-field"><tr><td><input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" data-toggle="date" autocomplete="off" class="form-control input-sm"></td><td class="date-apart"> - </td><td><input name="'+r.name+'" id="'+r.id+'" value="'+r.value+'" type="text" autocomplete="off" data-toggle="date" class="form-control input-sm"></td></tr></table>');a[t].value.append(l)},i._second2=function(t,i,o){var n=f(t,0),r=f(t,1),l=e('<table class="table date-field"><tr><td><input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" autocomplete="off" data-toggle="date" class="form-control input-sm"></td><td class="date-apart"> - </td><td><input name="'+r.name+'" id="'+r.id+'" value="'+r.value+'" type="text" autocomplete="off" data-toggle="date" class="form-control input-sm"></td></tr></table>');a[t].value.append(l)},i._birthday=function(t,i,o){var n=f(t,0),r=f(t,1),l=e('<input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" data-toggle="date" autocomplete="off" data-format="MM-dd" class="form-control input-sm"> - <input name="'+r.name+'" id="'+r.id+'" value="'+r.value+'" type="text" data-toggle="date" autocomplete="off" data-format="MM-dd" class="form-control input-sm">');a[t].value.append(l)},i._birthday2=function(t,i,o){var n=f(t,0),r=f(t,1),l=e('<input name="'+n.name+'" id="'+n.id+'" value="'+n.value+'" type="text" data-toggle="date" autocomplete="off" data-format="MM-dd" class="form-control input-sm"> - <input name="'+r.name+'" id="'+r.id+'" value="'+r.value+'" type="text" data-toggle="date" autocomplete="off" data-format="MM-dd" class="form-control input-sm">');a[t].value.append(l)},i._dialog=function(t,o,r,l){var d=f(o,r),c=[];if(t.query&&(t.query.multi="undefined"==t.query.multi?1:t.query.multi,e.each(t.query,(function(e,t){c.push("data-"+e+'="'+t+'"')}))),n)var u=i.find("#"+s+o);else u=i.find("#"+s+"0").find("option:selected");var p='<div class="select-group input-group">';p+='<input class="form-control input-sm" data-toggle="dialog-view" readonly="readonly" data-title="'+u.data().title+'" data-url="'+t.url+'" data-id="'+d.id+'" '+c.join(" ")+' style="min-width:153px;cursor:pointer;" id="'+d.id+'_text" />',p+='<input type="hidden" id="'+d.id+'" name="'+d.name+'" value="'+d.value+'">',p+='<div class="input-group-btn">',p+='<a data-toggle="dialog-clear" data-id="'+d.id+'" class="btn btn-sm btn-default"><i class="fa fa-times"></i></a>',p+="</div>",a[o].value.append(e(p))};var g={empty:function(e){a[e].value.empty()},text:function(e){i._text(e)},select2:function(e){i._text(e)},select:function(e,t){i._select(t,e)},number:function(e){i._text(e)},year:function(e){i._year(e)},date:function(e){i._date(e)},date2:function(e){i._date2(e)},birthday:function(e){i._birthday(e)},dialog:function(e,t){i._dialog(t,e)},second:function(e){i._date(e)},second2:function(e){i._second2(e)},option:function(e,t){i._select(t,e)},address:function(e){var t=f(e,0),i=f(e,1),o='<select name="'+t.name+'" id="'+t.id+'" class="form-control input-sm"></select>&nbsp;<select name="'+i.name+'" id="'+i.id+'" class="form-control input-sm"></select>';a[e].value.append(o),new pcas(t.id,i.id,t.value,i.value)},region:function(t){var o=f(t,0),n=f(t,1),r=f(t,2),l=o.value,s=n.value,d=r.value;function c(t,i){e.get(app.url("index/api/region",{layer:2,parent_id:l}),(function(t){var i="";e.map(t,(function(e){i+='<option value="'+e.id+'">'+e.name+"</option>"}));var a=e("#"+n.id).html(i);s&&a.val(s)}))}function u(t,i){e.get(app.url("index/api/region",{layer:3,parent_id:s}),(function(t){var i="";e.map(t,(function(e){i+='<option value="'+e.id+'">'+e.name+"</option>"}));var a=e("#"+r.id).html(i);d&&a.val(d)}))}a[t].value.append('<select name="'+o.name+'" id="'+o.id+'" class="form-control input-sm"></select>&nbsp;<select name="'+n.name+'" id="'+n.id+'" class="form-control input-sm"></select>&nbsp;<select name="'+r.name+'" id="'+r.id+'" class="form-control input-sm"></select>'),e.get(app.url("index/api/region",{layer:1}),(function(a){var r="";e.map(a,(function(e){r+='<option value="'+e.id+'">'+e.name+"</option>"}));var p=e("#"+o.id).html(r);l&&p.val(l),c(t),u(t),i.on("change","#"+o.id,(function(){l=this.value,s=0,d=0,c(t),u(t)})),i.on("change","#"+n.id,(function(){s=this.value,d=0,u(t)}))}))},circle:function(t){var o=i.attr(t,0),n=i.attr(t,1),r=o.value,l=n.value;function s(t){var i='<option value=""> - </option>';r?e.post(app.url("customer/customer/dialog",{limit:500,circle_id:r}),(function(t){e.map(t.data,(function(e){i+='<option value="'+e.id+'">'+e.text+"</option>"}));var a=e("#"+n.id).html(i);l&&a.val(l)})):e("#"+n.id).html(i)}a[t].value.append('<select name="'+o.name+'" id="'+o.id+'" class="form-control input-sm"></select>&nbsp;<select name="'+n.name+'" id="'+n.id+'" class="form-control input-sm"></select>'),e.post(app.url("customer/circle/dialog"),(function(i){var a='<option value=""> - </option>';e.map(i,(function(e){a+='<option value="'+e.id+'">'+e.name+"</option>"}));var n=e("#"+o.id).html(a);r&&n.val(r),s(t)})),i.on("change","#"+o.id,(function(){r=this.value,l=0,s(t)}))}};return i.attr=f,i.element=a,i.options=t,"function"==typeof t.init&&t.init.call(this,g),function(){if(n)e.each(o.field,(function(e){u(i.find("#"+s+e).data("type"),e,o.option[e])}));else{var t=i.find("#"+s+"0");t.val(o.field[0]),u(t.find("option:selected").data("type"),0,o.option[0]),t.on("change",(function(){l=!0;var t=this.selectedIndex-1,i=e(this).find("option:selected").data("type");a[0].value.empty(),u(i,0,o.option[t])}))}}(),this}}(jQuery),function(e){var t=0;e.fn.dialog=function(i){var a=this,o=e(a),n=e(document.body),r=o.closest(".dialog");this.options=i;var l,s=function(){r.modal("show"),(i.onShow||function(){}).call(a)},d=function(){r.modal("hide")};if(i.constructor==Object){i=e.extend({show:!0,backdrop:!0,destroy:!1},i),0==r.size()&&(l='<div class="dialog modal"><div class="modal-dialog"><div class="modal-content">',i.title&&(l+='<div class="modal-header"><button type="button" data-dismiss="dialog" class="close">&times;</button><h4 class="modal-title"></h4></div>'),l+='<div class="modal-body"></div>',i.buttons.length>0&&(l+='<div class="modal-footer"></div>'),r=e(l+="</div></div></div>"),n.append(r),r.find(".modal-body").append(o),r.modal({backdrop:i.backdrop}),e(".modal-dialog").draggable({handle:".modal-header",iframeFix:!0}),function(t){var o=(t||i||{}).buttons||{},n=r.find(".modal-footer");for(var l in n.html(""),o){var s=o[l],d="btn-default";d=s.class||s.classed||d,$button=e('<button type="button" class="btn btn-sm '+d+'">'+s.text+"</button>"),$button.data("click",s.click),s.id&&$button.attr("id",s.id),n.append($button)}n.on("click",(function(t){var i=e(t.target).data("click");"function"==typeof i&&i.call(a,t)})),n.data("buttons",o)}(),r.find(".modal-title").html(i.title),i.dialogClass&&r.find(".modal-dialog").addClass(i.dialogClass),r.on("click","[data-dismiss='dialog']",(function(){(i.onClose||d).call(a)})),r.one("show.bs.modal",(function(){t++})),r.one("hidden.bs.modal",(function(){--t>0&&(r.modal("checkScrollbar"),n.addClass("modal-open"),r.modal("setScrollbar")),1==i.destroy&&r.remove()})),i.modalClass&&r.addClass(i.modalClass)),i.show&&s()}return"destroy"==i&&(i.destroy=!0,d()),"close"==i&&d(),"show"==i&&s(),a}}(jQuery),function(e){var t={text:"确定",classed:"btn-info"},i={text:"取消",classed:"btn-default"};e.messager={},e.messager.alert=function(i,a,o){arguments.length<2&&(a=i||"",i="&nbsp;"),e("<div>"+a+"</div>").dialog({title:i,destroy:!0,dialogClass:"modal-sm",buttons:[{text:t.text,classed:t.classed||"btn-success",click:function(){"function"==typeof o&&o(),e(this).dialog("destroy")}}]})},e.messager.confirm=function(a,o,n){e("<div>"+o+"</div>").dialog({title:a,destroy:!0,backdrop:"static",dialogClass:"modal-sm modal-confirm",buttons:[{text:i.text,classed:i.classed||"btn-danger",click:function(){e(this).dialog("destroy"),"function"==typeof n&&n(!1)}},{text:t.text,classed:t.classed||"btn-success",click:function(){e(this).dialog("destroy"),"function"==typeof n&&n(!0)}}]})}}(jQuery),function(e){var t=0;e.dialog=function(i){var a=t,o={title:"Dialog",modalClass:"no-padder",dialogClass:"modal-md",destroy:!0,index:t,onShow:function(){var t=this;if(o=i.url){var o=o+(o.indexOf("?")<0?"?":"&")+"dialog_index="+a;e.get(o,(function(e){t.html(e)}))}i.html&&this.html(i.html)},buttons:[{text:"取消",click:function(){e(this).dialog("close")}},{text:"确定",class:"btn-primary",click:function(){e(this).dialog("close")}}]};i=e.extend(o,i);var n="gdoo-dialog-"+t,r=e("#"+n);return 0==r.length&&(r=e("<div/>",{id:n}),t++),r.dialog(i),a}}(jQuery),jQuery.toastr=function(e,t,i){toastr.options={closeButton:!0,debug:!1,progressBar:!1,positionClass:"toast-top-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},toastr[e](t,i)},function(window){var calc={rmb:function(e){var t,i,a,o,n,r,l,s,d,c,u,p,f,g,h="零",m="壹",v="贰",y="叁",w="肆",b="伍",x="陆",_="柒",$="捌",k="玖",C="拾",S="佰",D="仟",M="万",E="亿",I="元",N="角",R="分",j="整";if(""==(e=e.toString()))return"";if(null!=e.match(/[^,.\d]/))return"";if(null==e.match(/^((\d{1,3}(,\d{3})*(.((\d{3},)*\d{1,3}))?)|(\d+(.\d+)?))$/))return"";if(e=(e=e.replace(/,/g,"")).replace(/^0+/,""),Number(e)>99999999999.99)return"";if((o=e.split(".")).length>1?(t=o[0],i=(i=o[1]).substr(0,2)):(t=o[0],i=""),n=new Array(h,m,v,y,w,b,x,_,$,k),r=new Array("",C,S,D),l=new Array("",M,E),s=new Array(N,R),a="",Number(t)>0){for(d=0,c=0;c<t.length;c++)f=(u=t.length-c-1)/4,g=u%4,"0"==(p=t.substr(c,1))?d++:(d>0&&(a+=n[0]),d=0,a+=n[Number(p)]+r[g]),0==g&&d<4&&(a+=l[f]);a+=I}if(""!=i)for(c=0;c<i.length;c++)"0"!=(p=i.substr(c,1))&&(a+=n[Number(p)]+s[c]);return""==a&&(a=h+I),""==i&&(a+=j),a},max:function(){if(0!=arguments.length){for(var e=arguments[0],t=0;t<arguments.length;t++)e=Math.max(e,arguments[t]);return parseFloat(e)}},min:function(){if(0!=arguments.length){for(var e=arguments[0],t=0;t<arguments.length;t++)e=Math.min(e,arguments[t]);return parseFloat(e)}},avg:function(){for(var e=arguments,t=e.length,i=0,a=0;i<t&&(a+=parseFloat(e[i]));i++);return a/t},mod:function(){if(0!=arguments.length){var e=arguments[0],t=arguments[1],i=e%t;return i=isNaN(i)?"":parseFloat(i)}},abs:function(e){return Math.abs(parseFloat(e))},val:function(e,t){return isNaN(e)||e===1/0?0:e.toFixed(t)},day:function(e){return 0==e?0:Math.floor(e/86400)},hour:function(e){return 0==e?0:Math.floor(e/3600)},date:function(e){var t="天",i="小时",a="分",o="秒",n="日期格式无效";return e>=0?Math.floor(e/86400)+t+Math.floor(e%86400/3600)+i+Math.floor(e%3600/60)+a+Math.floor(e%60)+o:n},list:function(e,t){for(var i=0,a=document.getElementById("body_"+e),o=0;o<a.rows.length;o++)for(var n=0;n<a.rows[o].cells.length;n++)if(n==t){var r=a.rows[o].cells[n].firstChild;if(r&&r.tagName){var l=r.value||r.innerText;l=""==l||""==l.replace(/\s/g,"")?0:l,l=isNaN(l)?NaN:l,i+=parseFloat(l)}else i+=parseFloat(r.data)}return parseFloat(i)},getVal:function(e,t){var i=$("#"+e);if(0==i.length)return 0;if("listview"==t)return document.getElementById("lv_"+e);if("date"==t){var a=$("#"+e).val();return new Date(a).getTime()/1e3}return""==(a=i.val())&&(a=0),a},sum:function(){var e,t,i=[].slice.call(arguments,0),a=0;for(e=i.length;e--;)a+=(t=parseFloat(i[e]))==t?t:0;return a}},listView={calc,field:{},data:{},total:{},editor:function(e,t,i){var a=listView.field[e],o=a.type[i],n=a.size[i],r="SYS_NOT_NULL"==a.checks[i]?"input-required":"input-text",l=1!=a.writes[i],s="";listView.data[e][t]&&(s=null==listView.data[e][t][i]?"":listView.data[e][t][i]);var d=e+"["+t+"]["+i+"]",c=e+"_"+t+"_"+i;switch(o){case"empty":var u='<span tyle="width:'+n+'px;" id="'+c+'"></span>';break;case"text":u=0==l?'<input autocomplete="off" type="text" style="width:'+n+'px;" class="'+r+'" name="'+d+'" id="'+c+'" value="'+s+'">':'<span id="'+c+'">'+s+"</span>";break;case"textarea":u=0==l?'<textarea style="width:'+n+'px;" class="'+r+'" name="'+d+'" id="'+c+'">'+s+"</textarea>":'<span id="'+c+'">'+s+"</span>";break;case"calc":u=0==l?'<input type="text" style="width:'+n+'px;" class="readonly" name="'+d+'" id="'+c+'" value="'+s+'" readonly>':'<span id="'+c+'">'+s+"</span>";break;case"select":var p=a.value[i].split(",");(g=[]).push("<select style=width:"+n+'px;" name="'+d+'" id="'+c+'">');for(t=0;t<p.length;t++){var f=s==p[t]?" selected":"";g.push('<option value="'+p[t]+'"'+f+">"+p[t]+"</option>")}g.push("</select>"),u=0==l?g.join("\n"):'<span id="'+c+'">'+s+"</span>";break;case"radio":p=a.value[i].split(",");var g=[];for(t=0;t<p.length;t++){var h=s==p[t]?" checked":"";g.push('<label class="checkbox"><input type="radio" name="'+d+'" id="'+c+'"'+h+">"+p[t]+"</label>")}u=0==l?g.join("\n"):'<span id="'+c+'">'+s+"</span>";break;case"checkbox":for(p=a.value[i].split(","),g=[],t=0;t<p.length;t++){h=s==p[t]?" checked":"";g.push('<label class="checkbox"><input type="checkbox" name="'+d+'" id="'+c+'"'+h+">"+p[t]+"</label>")}u=0==l?g.join("\n"):'<span id="'+c+'">'+s+"</span>";break;case"datetime":u=0==l?'<input autocomplete="off" type="text" style=width:'+n+'px;" onfocus="datePicker({dateFmt:\'yyyy-MM-dd\'});" class="'+r+' popDate" value="'+s+'" name="'+d+'" id="'+c+'">':'<span id="'+c+'">'+s+"</span>"}return u},rowUpdate:function(e){var t=e.target.id.split("_");if(4==t.length){var i=t[0]+"_"+t[1];listView.rowSum(i,t[2]),listView.footerSum(i)}},footerSum:function(e){for(var t=document.getElementById("body_"+e),i=listView.field[e],a=i.sum,o=(i.readonly,0);o<a.length;o++)if(1==a[o]){for(var n=0,r=0;r<t.rows.length;r++){var l=t.rows[r].cells[o+1],s=0==i.readonly?$(l).find("input,select").val():$(l).find("span").text();s=parseFloat(s),n+=isNaN(s)?0:Math.round(1e4*parseFloat(s))/1e4}n=n.toFixed(2),$("#total_"+e+"_"+o).html(n)}},rowSum:function rowSum(key,j){for(var field=listView.field[key],type=field.type,value=field.value,readonly=field.readonly,calc=[],i=0;i<type.length;i++)if("calc"==type[i]){calc[i]=value[i];for(var k=0;k<type.length;k++){var n=k+1,td=$("#"+key+"_"+j+"_"+k),td_value=0==readonly?td.val():td.text();calc[i]=calc[i].replace("["+n+"]",parseFloat(td_value))}row=isNaN(eval(calc[i]))?0:Math.round(1e4*parseFloat(eval(calc[i])))/1e4,row=row.toFixed(2);var obj=$("#"+key+"_"+j+"_"+i);0==readonly?obj.val(row):obj.text(row)}},rowAdd:function(e){i=listView.total[e];var t=[];t.push('<tr><td align="center">'+(i+1)+"</td>");for(var a=0;a<listView.field[e].type.length;a++)t.push("<td>"+listView.editor(e,i,a)+"</td>");if(0==listView.field[e].readonly){var o=i>0?'<a class="option" href="javascript:;" onclick="listView.deleteRow(\''+e+"',this);\">删除</a>":'<a class="option" onclick="listView.rowAdd(\''+e+'\');" href="javascript:;">添加</a>';t.push('<td align="center" style="white-space:nowrap;">'+o+"</td></tr>")}$("#body_"+e).append(t.join("\n")),listView.total[e]++},deleteRow:function(e,t){var i=t.parentNode.parentNode;i.parentNode.removeChild(i),listView.footerSum(e)},init:function(e){listView.total[e]=0;for(var t=listView.data[e].length>0?listView.data[e].length:1,i=0;i<t;i++)listView.rowAdd(e),listView.rowSum(e,i);listView.footerSum(e)}};window.listView=listView}(window),function(e){function t(e){var t={},i=formGridList[e]||[];if(i.length)for(var a=0;a<i.length;a++){var o=i[a],n=o.api.memoryStore,r=[];o.api.stopEditing(),o.api.forEachNode((function(e){var t=e.data;isNotEmpty(t[o.dataKey])&&(0===(""+t.id).indexOf("draft_")&&(t.id=0),r.push(t))}));var l=gdoo.event.get("grid."+o.tableKey);if(l.exist("onSaveBefore"))if(!1===l.trigger("onSaveBefore",r))return!1;if(0==r.length)return toastrError(o.tableTitle+"不能为空。"),!1;t[o.tableKey]={rows:r,deleteds:n.deleted}}return t}function i(e){for(var t=top.document.getElementsByTagName("iframe"),i=0;i<t.length;i++){var a=t[i],o=a.contentWindow.gdoo;if("tab_iframe_dashboard"==a.id)Object.values(o.widgets).forEach((function(e){e.remoteData()}));else if(o&&o.grids){var n=o.grids;n[e]&&n[e].grid.remoteData()}}}e.gridListData=t;var a={bill_url:"",audit:function(e){var a=$("#"+e),o=a.find("#master_key").val(),n=a.find("#master_run_id").val(),r=a.find("#master_step_id").val(),l=a.find("#master_run_log_id").val(),s=$("#"+e).find("#master_uri").val(),d=app.url(s+"/flowAudit",{key:o,run_id:n,step_id:r,run_log_id:l});$.dialog({title:"单据审批",url:d,buttons:[{text:"取消",class:"btn-default",click:function(){$(this).dialog("close")}},{text:"提交",class:"btn-info",click:function(){var a=$("#myturn,#"+e).serialize(),o=t(e);if(!1!==o){var n=showLoading();$.post(app.url(s+"/flowAudit"),a+"&"+$.param(o),(function(t){t.status?(i(e),toastrSuccess(t.data),t.url&&(location.href=t.url)):toastrError(t.data)}),"json").complete((function(){layer.close(n)}))}}}]})},draft:function(e){var a=$("#"+e).find("#master_uri").val(),o=$("#myturn,#"+e).serialize(),n=t(e);if(!1!==n){var r=showLoading(),l=gdoo.event.get("grid."+e);$.post(app.url(a+"/flowDraft"),o+"&"+$.param(n),(function(t){l.exist("onSaveAfter")&&(t=l.trigger("onSaveAfter",t)),t.status?(i(e),toastrSuccess(t.data),t.url&&(location.href=t.url)):toastrError(t.data)}),"json").complete((function(){layer.close(r)}))}},remove:function(e){$.messager.confirm("操作警告","确定要删除吗？",(function(t){1==t&&$.post(e,(function(e){e.status?(toastrSuccess(e.data),location.reload()):toastrError(e.data)}),"json")}))},store:function(e){var a=$("#"+e).find("#master_uri").val(),o=$("#"+e).serialize(),n=t(e);if(!1!==n){var r=showLoading();$.post(app.url(a+"/store"),o+"&"+$.param(n),(function(t){t.status?(i(e),toastrSuccess(t.data),t.url&&(location.href=t.url)):toastrError(t.data)}),"json").complete((function(){layer.close(r)}))}},read:function(e){var t=$("#"+e).find("#master_uri").val(),a=$("#"+e).serialize(),o=showLoading();$.post(app.url(t+"/flowRead"),a,(function(t){t.status?(i(e),toastrSuccess(t.data),location.reload()):toastrError(t.data)}),"json").complete((function(){layer.close(o)}))},reset:function(e){$.messager.confirm("操作警告","确定要重置流程吗",(function(t){if(1==t){var i=$("#"+e).find("#master_uri").val(),a=$("#"+e).serialize(),o=showLoading();$.post(app.url(i+"/flowReset"),a,(function(e){e.status?location.reload():toastrError(e.data)}),"json").complete((function(){layer.close(o)}))}}))},auditLog:function(e){var t=app.url("index/workflow/flowLog",{key:e});$.dialog({title:"审批记录",dialogClass:"modal-lg",url:t,buttons:[{text:"取消",class:"btn-default",click:function(){$(this).dialog("close")}}]})},revise:function(e){formDialog({title:"流程修正",url:app.url("index/workflow/flowRevise",{key:e}),dialogClass:"modal-md",id:"revise-form",success:function(e){toastrSuccess(e.data),location.reload(),$(this).dialog("close")},error:function(e){toastrError(e.data)}})},recall:function(e){var t=$("#"+e).find("#master_key").val(),a=$("#"+e).find("#master_uri").val(),o=$("#"+e).find("#master_recall_log_id").val(),n=app.url(a+"/recall",{key:t,log_id:o});$.dialog({title:"撤回单据",url:n,buttons:[{text:"取消",class:"btn-default",click:function(){$(this).dialog("close")}},{text:"提交",class:"btn-info",click:function(){var t=$("#myrecall").serialize(),o=showLoading();$.post(app.url(a+"/recall"),t,(function(t){t.status?(i(e),toastrSuccess(t.data),location.reload()):toastrError(t.data)}),"json").complete((function(){layer.close(o)}))}}]})},abort:function(e){var t=$("#"+e).find("#master_key").val(),a=$("#"+e).find("#master_uri").val(),o=app.url(a+"/abort",{key:t});$.dialog({title:"弃审单据",url:o,buttons:[{text:"取消",class:"btn-default",click:function(){$(this).dialog("close")}},{text:"提交",class:"btn-info",click:function(){var t=$("#myabort").serialize(),o=showLoading();$.post(app.url(a+"/abort"),t,(function(t){t.status?(i(e),toastrSuccess(t.data),location.reload()):toastrError(t.data)}),"json").complete((function(){layer.close(o)}))}}]})},audit2:function(e){var t=$("#"+e).find("#master_key").val(),a=$("#"+e).find("#master_uri").val();$.messager.confirm("操作警告","确定要审核单据吗",(function(o){if(1==o){var n=showLoading();$.post(app.url(a+"/audit"),{key:t},(function(t){t.status?(i(e),toastrSuccess(t.data),location.reload()):toastrError(t.data)}),"json").complete((function(){layer.close(n)}))}}))},abort2:function(e){var t=$("#"+e).find("#master_key").val(),a=$("#"+e).find("#master_uri").val();$.messager.confirm("操作警告","确定要弃审单据吗",(function(o){if(1==o){var n=showLoading();$.post(app.url(a+"/abort"),{key:t},(function(t){t.status?(i(e),top.$.toastr("success",t.data),location.reload()):top.$.toastr("error",t.data)}),"json").complete((function(){layer.close(n)}))}}))},createRow:function(t){var i=gdoo.forms[t],a=e[t+".onCreateRow"];if("function"==typeof a&&!1===a.call(i,t))return!1;i.api.memoryStore.create({})},deleteRow:function(t){var i=gdoo.forms[t],a=e[t+".onDeleteRow"];if("function"==typeof a&&!1===a.call(i,t))return!1;var o=i.api.getSelectedNodes();if(o&&1===o.length){var n=o[0];i.api.deleteRow(n.data),i.api.forEachNode((function(e){e.childIndex!==n.childIndex||e.setSelected(!0)}))}},quickFilter:function(e){var t=gdoo.forms[e],i=$("#"+e+"_quick_filter_text"),a=i.dialog({title:'<i class="fa fa-filter"></i> 过滤'+t.tableTitle,modalClass:"no-padder",dialogClass:"modal-sm",buttons:[{text:"确定",classed:"btn-info",click:function(){t.api.setQuickFilter(i.find("input").val()),a.dialog("close")}},{text:"取消",classed:"btn-default",click:function(){a.dialog("close")}}]}).on("keydown",(function(e){13==e.keyCode&&(t.api.setQuickFilter(i.find("input").val()),a.dialog("close"))}))},closeRow:function(e){var t=this,i=gdoo.forms[e],a=i.api.getSelectedRows();if(a.length>0){var o=a[0].id;top.$.messager.confirm("操作提醒","是否要关闭选中的行数据?",(function(a){if(1==a){var n=showLoading();$.post(app.url(t.bill_url+"/closeRow"),{table:e,id:o},(function(e){e.status?(toastrSuccess(e.data),i.remoteData()):toastrError(e.data)}),"json").complete((function(){layer.close(n)}))}}))}else toastrError("最少选择一行记录。")},closeAllRow:function(e){var t=this,i=gdoo.forms[e],a=[];i.api.forEachNode((function(e){a.push(e.data.id)})),a.length>0?top.$.messager.confirm("操作提醒","是否要关闭所有行数据?",(function(o){if(1==o){var n=showLoading();$.post(app.url(t.bill_url+"/closeAllRow"),{table:e,ids:a},(function(e){e.status?(toastrSuccess(e.data),i.remoteData()):toastrError(e.data)}),"json").complete((function(){layer.close(n)}))}})):toastrError("最少选择一行记录。")}};e.flow=a}(window),function(e){window.gridAction=function(t,i){this.name=i,this.table=t,this.dialogType="dialog",this.show=function(t,i,a){var o=this;if(1!=t.flow_form_edit){var n=app.url(o.bill_url+"/show",{id:t.master_id});"dialog"==o.dialogType?viewDialog({title:o.name,dialogClass:"modal-lg",url:n,close:function(){e(this).dialog("close")}}):(isEmpty(i)&&(i=o.bill_url.replace(/\//g,"_")+"_show"),isEmpty(a)&&(a=o.name),top.addTab(o.bill_url+"/show?id="+t.master_id,i,a))}else o.audit(t)},this.import=function(){var t=this,i=gdoo.grids[t.table].grid;formDialog({title:"数据导入",url:app.url(t.bill_url+"/import"),dialogClass:"modal-md",id:"import-dialog",onSubmit:function(){var a=new FormData;a.append("file",e("#import_file")[0].files[0]);var o=showLoading();e.ajax({url:app.url(t.bill_url+"/import"),type:"POST",data:a,processData:!1,contentType:!1,complete:function(){layer.close(o)},success:function(t){t.status?(e("#modal-import-dialog").dialog("close"),i.remoteData(),toastrSuccess(t.data)):toastrError(t.data)}})}})},this.delete=function(){var t=this,i=gdoo.grids[t.table].grid,a=i.api.getSelectedRows(),o=[];if(e.each(a,(function(e,t){o.push(t.master_id)})),o.length>0){var n=o.length+"个"+t.name+"将被删除？";top.$.messager.confirm("删除"+t.name,n,(function(a){if(1==a){var n=showLoading();e.post(app.url(t.bill_url+"/delete"),{id:o},(function(e){e.status?(toastrSuccess(e.data),i.remoteData()):toastrError(e.data)}),"json").complete((function(){layer.close(n)}))}}))}else toastrError("最少选择一行记录。")},this.created_by=function(t){var i=gdoo.grids[this.table].grid;formDialog({title:"私信",url:app.url("user/message/create",{user_id:t.id}),storeUrl:app.url("model/form/store"),id:"user_message",dialogClass:"modal-md",success:function(t){toastrSuccess(t.data),i.remoteData(),e(this).dialog("close")},error:function(e){toastrError(e.data)}})},this.create=function(){var t=this,i=gdoo.grids[t.table].grid;if("dialog"==t.dialogType)formDialog({title:"新建"+t.name,url:app.url(t.bill_url+"/create"),storeUrl:app.url(t.bill_url+"/store"),id:t.table,table:t.table,dialogClass:"modal-lg",success:function(t){toastrSuccess(t.data),i.remoteData(),e(this).dialog("close")},error:function(e){toastrError(e.data)}});else{var a=t.bill_url.replace(/\//g,"_")+"_show";top.addTab(t.bill_url+"/create",a,t.name)}},this.edit=function(t){var i=this,a=gdoo.grids[i.table].grid;if("dialog"==i.dialogType)formDialog({title:"编辑"+i.name,url:app.url(i.bill_url+"/edit",{id:t.master_id}),storeUrl:app.url(i.bill_url+"/store"),id:i.table,table:i.table,dialogClass:"modal-lg",success:function(t){toastrSuccess(t.data),a.remoteData(),e(this).dialog("close")},error:function(e){toastrError(e.data)}});else{var o=i.bill_url.replace(/\//g,"_")+"_show";top.addTab(i.bill_url+"/edit?id="+t.master_id,o,i.name)}},this.audit=function(t){var i=this,a=gdoo.grids[i.table].grid;if("dialog"==i.dialogType)formDialog({title:"审核"+i.name,url:app.url(i.bill_url+"/audit",{id:t.master_id}),storeUrl:app.url(i.bill_url+"/store"),id:i.table,table:i.table,dialogClass:"modal-lg",success:function(t){toastrSuccess(t.data),a.remoteData(),e(this).dialog("close")},error:function(e){toastrError(e.data)}});else{var o=i.bill_url.replace(/\//g,"_")+"_show";top.addTab(i.bill_url+"/audit?id="+t.master_id,o,i.name)}},this.batchEdit=function(){var t=gdoo.grids[this.table].grid,i=t.api.getSelectedRows(),a=[];e.each(i,(function(e,t){a.push(t.master_id)})),a.length>0?formDialog({title:"批量编辑",dialogClass:"modal-sm",id:"batch-edit-form",url:app.url(this.bill_url+"/batchEdit",{ids:a.join(",")}),success:function(i){toastrSuccess(i.data),t.remoteData(),e(this).dialog("close")},close:function(){e(this).dialog("close")}}):toastrError("最少选择一行记录。")},this.export=function(){LocalExport(gdoo.grids[this.table].grid,this.name)},this.filter=function(){var t=gdoo.grids[this.table],i=t.grid,a=t.search;e(a.advanced.el).dialog({title:"高级搜索",modalClass:"no-padder",buttons:[{text:"取消",class:"btn-default",click:function(){e(this).dialog("close")}},{text:"确定",class:"btn-info",click:function(){var t=a.advanced.el.serializeArray(),o={};return a.queryType="advanced",e.map(t,(function(e){o[e.name]=e.value})),o.page=1,i.remoteData(o),e(this).dialog("close"),!1}}]})}}}(jQuery);var select2List={},dialogCacheSelected={};$((function(){var e=$(document);e.ajaxError((function(e,t){t.responseJSON&&toastrError(t.responseJSON.message)}));var t=e.find(".input-select2");t.length&&t.select2(),e.tooltip({container:"body",placement:"auto",selector:".hinted",delay:{show:200,hide:0}}),$(".select-all").on("click",(function(){var e=$(".select-row").closest("tr");$(this).prop("checked")?e.addClass("success"):e.removeClass("success"),$(".select-row").prop("checked",$(this).prop("checked"))})),e.on("click",'[data-toggle="closetab"]',(function(){if(window.name)var e=window.name.replace("iframe_","");else e=$(this).data("id");top.$.addtabs.close({id:"tab_"+e})})),$(".table tbody tr").on("click",(function(e){var t=$(this),i=t.find(".select-row"),a=i.prop("checked");function o(e){e?t.addClass("success"):t.removeClass("success"),i.prop("checked",e)}0!=i.length&&("INPUT"==e.target.tagName&&o(a),"DIV"==e.target.tagName&&o(!a),"TD"==e.target.tagName&&o(!a))})),e.on("change",'[data-toggle="redirect"]',(function(){var e=$(this).data("url"),t=$(this).attr("id"),i=$(this).find("option:selected").val();location.href=e.replace(new RegExp("("+t+"=)[^&]*","g"),"$1"+i)})),e.on("click.dialog.search",'[data-toggle="dialog-clear"]',(function(){var e=$(this).data();$("#"+e.id).val(""),$("#"+e.id+"_text").val(""),gdoo.event.get(e.id).trigger("clear",e)})),e.on("click.dialog.view",'[data-toggle="dialog-view"]',(function(){var e=$(this).data(),t={};$.each(e,(function(e,i){if("url"==e||"title"==e||"toggle"==e)return!0;t[e]=i}));var i=getIframeName();i&&(t.iframe_id=i);var a=gdoo.formKey(e),o=gdoo.event.get(a.key);o.trigger("open",e,t);var n=e.url,r=e.title;n=app.url(n,t);$.dialog({title:r,url:n,dialogClass:"modal-lg",buttons:[{text:"取消",class:"btn-default",click:function(){$(this).dialog("close")}},{text:"确定",class:"btn-info",click:function(){var t=gdoo.dialogs[a.id];t?!0===gdoo.dialogSelected(o,e,a,t)&&$(this).dialog("close"):$(this).dialog("close")}}]})}));var i=e.find(".gdoo-dialog-input");i.length&&i.gdooDialogInput(),e.on("click.dialog.image",'[data-toggle="dialog-image"]',(function(){var e=$(this).data();$.dialog({title:e.title,html:'<img style="text-align:center;max-width:100%;" src="'+e.url+'" />',buttons:[{text:"确定",class:"btn-default",click:function(){$(this).dialog("close")}}]})})),e.on("click.dialog.form",'[data-toggle="dialog-form"]',(function(){var e=$(this).data();e.id=e.id||"myform",e.size=e.size||"md",$.dialog({title:e.title,url:e.url,dialogClass:"modal-"+e.size,buttons:[{text:"取消",class:"btn-default",click:function(){"function"==typeof error?error.call(this,res):$(this).dialog("close")}},{text:"保存",class:"btn-info",click:function(){var t=this,i=$("#"+e.id).attr("action"),a=$("#"+e.id).serialize();$.post(i,a,(function(e){"function"==typeof success?success.call(t,e):e.status?"reload"==e.data?window.location.reload():(toastrSuccess(e.data),$(t).dialog("close")):toastrError(e.data)}),"json")}}]})})),e.on("click.date",'[data-toggle="date"]',(function(){var e=$(this).data(),t={};t.dateFmt=e.format||"yyyy-MM-dd";var i=window[this.id+".onpicked"];"function"==typeof i&&(t.onpicked=i),e.dchanging&&(t.dchanging=e.dchanging),datePicker(t)})),e.on("click.datetime",'[data-toggle="datetime"]',(function(){var e=$(this).data(),t={};t.dateFmt=e.format||"yyyy-MM-dd",e.dchanging&&(t.dchanging=e.dchanging),datePicker(t)})),e.on("click.frame.close",'[data-toggle="layer-frame-close"]',(function(){var e=parent.layer.getFrameIndex(window.name);parent.layer.close(e)})),e.on("click.frame.url",'[data-toggle="layer-frame-url"]',(function(){var e=$(this).data("url"),t=$(this).data("title")||!1,i=$(this).data("skin")||"frame",a=$(this).data("close")||!1;layer.open({skin:"layui-layer-"+i,scrollbar:!1,closeBtn:a,title:t,type:2,move:!1,area:["100%","100%"],content:e})})),e.on("click.tab.frame",'[data-toggle="tab-frame-url"]',(function(){var e=$(this).data("url"),t=$(this).data("id"),i=$(this).data("name");top.addTab(e,t,i)})),e.on("click",'[data-toggle="media-delete"]',(function(){var e=$(this).parent();$(this).closest(".media-controller").find(".media-item").length>1?e.remove():(e.find("img").attr("src",app.url("assets/images/nopic.jpg")),e.find("input").val(""))})),$("a.image-show").hover((function(e){var t=$(this).data(),i=$('<p id="image"><img src="'+t.url+'" alt="" /></p>');$("body").append(i),$(this).find("img").stop().fadeTo("slow",.5);var a=$(window),o=$(document).find("#image"),n=o.height(),r=o.width(),l=(a.scrollLeft(),a.width(),a.scrollTop()+(a.height()-n)/2+"px"),s=$(this).offset();o.css({left:s.left+100,top:l}),o.fadeIn("fast")}),(function(){$(this).find("img").stop().fadeTo("slow",1),$("#image").remove()})),$("#table-sortable tbody").sortable({delay:50,cursor:"move",axis:"y",items:"tr",handle:"td.move",helper:function(e,t){return t.children().each((function(){$(this).width($(this).width())})),t},stop:function(e,t){},start:function(e,t){t.placeholder.outerHeight(t.item.outerHeight())},update:function(){var e=$(this).parent().attr("url"),t=$(this).sortable("toArray");$.post(e,{sort:t},(function(e){toastrSuccess(e.data)}))}})}));var app={confirm:function(e,t,i){i=i||"操作警告",$.messager.confirm(i,t,(function(t){1==t&&(location.href=e)}))},alert:function(e,t){$.messager.alert(e,t)},url:function(e,t){return"/"==e?settings.public_url:(query=""==t||void 0===t?"":"?"+$.param(t),settings.public_url+"/"+e+query)},redirect:function(e,t){return window.location.href=app.url(e,t)},pinyin:function(e,t,i){i=i||"first",""==$("#"+t).val()&&$.get(app.url("index/api/pinyin?type="+i+"&id="+Math.random()),{name:$("#"+e).val()},(function(e){$("#"+t).val(e)}))}},uploader={file:function(e){var t=$("#"+e).find(".id").val();location.href=app.url("index/attachment/download",{id:t})},cancel:function(e){var t=$("#"+e).find(".id").val();if(t>0){var i=$("#"+e).find(".file-name a").text();$.messager.confirm("删除文件","确定要删除 <strong>"+i+"</strong> 此文件吗",(function(i){1==i&&$.get(app.url("index/attachment/delete"),{id:t},(function(t){1==t&&$("#"+e).remove()}))}))}else $("#"+e).remove()},insert:function(e){var t=$("#"+e).find(".id").val(),i=$("#"+e).find(".file-name a").text();if(/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(i))var a='<img src="'+app.url("index/attachment/show",{id:t})+'" title="'+i+'">';else a='<a href="'+app.url("index/attachment/download",{id:t})+'" title="'+i+'">'+i+"</a>";UE.getEditor("content").execCommand("insertHtml",a)}};function mediaDialog(e,t,i,a){var o={id:i,name:t,multi:a};e=app.url(e,o);$.dialog({title:"媒体管理",url:e,dialogClass:"modal-lg",buttons:[{text:'<i class="fa fa-remove"></i> 取消',class:"btn-default",click:function(){$(this).dialog("close")}},{text:'<i class="fa fa-check"></i> 确定',class:"btn-info",click:function(){window.saveMedia&&(window.saveMedia.call(this,o),$(this).dialog("close"))}}]})}function viewBox(e,t,i,a){a=a||"md",$.dialog({title:t,url:i,dialogClass:"modal-"+a,buttons:[{text:"确定",class:"btn-default",click:function(){$(this).dialog("close")}}]})}var viewDialogIndex=0;function viewDialog(e){void 0===e.id&&(e.id="view-dialog-"+viewDialogIndex,viewDialogIndex++);var t=$("#modal-"+e.id);t.length>0&&t.dialog("show");var i={title:name,url,buttons:[{text:"确定",class:"btn-default",click:function(){$(this).dialog("close")}}]},a=$.extend({},i,e);$.dialog(a)}var formDialogIndex=0;function formDialog(e){void 0===e.id&&(e.id="form-dialog-"+formDialogIndex,formDialogIndex++);var t=$("#modal-"+e.id);if(t.length>0)t.dialog("show");else{var i={title:"formDialog",backdrop:"static",buttons:[{text:"取消",class:"btn-default",click:function(){"function"==typeof error?error.call(this):$(this).dialog("close")}},{text:"保存",class:"btn-info",click:function(){var e=this,t=e.options;if("function"==typeof t.onSubmit)t.onSubmit.call(e);else{if(e.options.storeUrl)var i=e.options.storeUrl;else i=$("#"+t.id).attr("action");var a=$("#"+t.id).serialize(),o=gridListData(t.table);if(!1===o)return;var n=showLoading();$.post(i,a+"&"+$.param(o),(function(i){i.status?"function"==typeof t.success&&t.success.call(e,i):"function"==typeof t.error&&t.error.call(e,i)}),"json").complete((function(){layer.close(n)}))}}}]},a=$.extend({},i,e);$.dialog(a)}}function niceTime(e){var t=(new Date).getTime(),i=parseInt((t-1e3*e)/1e3);return i>=0&&i<60?i+"秒前":i>=60&&i<3600?parseInt(i/60)+"分钟前":i>=3600&&i<86400?parseInt(i/3600)+"小时前":parseInt(i/86400)+"天前"}function ucfirst(e){return e?e[0].toUpperCase()+e.substr(1):e}function digitUppercase(e){var t=["角","分"],i=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],a=[["元","万","亿"],["","拾","佰","仟"]],o=e<0?"欠":"";e=Math.abs(e);for(var n="",r=0;r<t.length;r++)n+=(i[Math.floor(10*e*Math.pow(10,r))%10]+t[r]).replace(/零./,"");n=n||"整",e=Math.floor(e);for(r=0;r<a[0].length&&e>0;r++){for(var l="",s=0;s<a[1].length&&e>0;s++)l=i[e%10]+a[1][s]+l,e=Math.floor(e/10);n=l.replace(/(零.)*零$/,"").replace(/^$/,"零")+a[0][r]+n}return o+n.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")}function number_format(e,t,i,a){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var o=isFinite(+e)?+e:0,n=isFinite(+t)?Math.abs(t):0,r=void 0===a?",":a,l=void 0===i?".":i,s="";return(s=(n?function(e,t){if(-1===(""+e).indexOf("e"))return+(Math.round(e+"e+"+t)+"e-"+t);var i=(""+e).split("e"),a="";return+i[1]+t>0&&(a="+"),(+(Math.round(+i[0]+"e"+a+(+i[1]+t))+"e-"+t)).toFixed(t)}(o,n).toString():""+Math.round(o)).split("."))[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,r)),(s[1]||"").length<n&&(s[1]=s[1]||"",s[1]+=new Array(n-s[1].length+1).join("0")),s.join(l)}function isEmpty(e){try{if(""==e||null==e||null==e)return!0;if("number"==typeof e)return!!isNaN(e);if("boolean"==typeof e||"function"==typeof e||e instanceof Date||e instanceof RegExp)return!1;if("string"==typeof e)return 0==e.trim().length;if("object"===_typeof(e)){if(e instanceof Array)return 0==e.length;if(e instanceof Object)return 0==Object.getOwnPropertyNames(e).length}}catch(e){return!1}}function isNotEmpty(e){return!isEmpty(e)}function delHtmlTag(e){return e.replace(/<[^>]+>/g,"")}function isWeiXin(){return"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}function toastrSuccess(e){isWeiXin()?$.toastr("success",e):top.$.toastr("success",e)}function toastrError(e){isWeiXin()?$.toastr("error",e):top.$.toastr("error",e)}function url(e,t){return query=""==t||void 0===t?"":"?"+$.param(t),settings.public_url+"/"+e+query}function format_datetime(e){function t(e){return e<10?"0"+e:e}e=1e3*parseInt(e);var i=new Date(e),a=i.getFullYear(),o=i.getMonth()+1,n=i.getDate(),r=i.getHours(),l=i.getMinutes();i.getSeconds();return a+"-"+t(o)+"-"+t(n)+" "+t(r)+":"+t(l)}function format_date(e){function t(e){return e<10?"0"+e:e}e=1e3*parseInt(e);var i=new Date(e),a=i.getFullYear(),o=i.getMonth()+1,n=i.getDate();i.getHours(),i.getMinutes(),i.getSeconds();return a+"-"+t(o)+"-"+t(n)}function ajaxSubmit(e,t){$("#"+e+"-form-submit").on("click",(function(){var i=$("#"+e),a=i.attr("action"),o=i.serialize(),n={};if(!1!==(n=gridListData(e))){o=o+"&"+$.param(n);var r=showLoading();return $.post(a,o,(function(e){"function"==typeof t?t(e):e.status?(toastrSuccess(e.data),e.url&&(self.location.href=e.url)):toastrError(e.data)}),"json").complete((function(){layer.close(r)})),!1}}))}function getIframeName(){var e=window.name;return e?e.replace("iframe_",""):""}function getIframeDocument(e){if(e){var t=window.frames["iframe_"+e];if(t)return t.document}return null}function showLoading(e){return layer.msg(e||"数据提交中...",{icon:16,shade:.1,time:12e4})}function fileFormatSize(e){return e<1024?e+"B":e<1048576?(e/1024).toFixed(2)+"KB":e<1073741824?(e/1048576).toFixed(2)+"MB":(e/1073741824).toFixed(2)+"GB"}function FindFile(e,t){$.post(app.url("index/attachment/draft"),{key:t},(function(t){var i=[],a="#fileDraft_"+e,o=$(a).find(".id");$.each(o,(function(e,t){i.push($(this).val())})),$.each(t,(function(e,t){if(-1==i.indexOf(t.id+"")){t.size=fileFormatSize(t.size);var o=template("uploader-item-tpl",t);$(a).append(o)}}))}))}function toNumber(e){return e=parseFloat(e),isNaN(e)?0:isFinite(e)?e:0}function StringBuilder(){this._stringArray=new Array}function LocalExport(e,t){if(0!=e.api.getDisplayedRowCount()){var i=[];$.each(e.columnDefs,(function(e,t){1!=t.checkboxSelection&&'"actionCellRenderer"'!=t.cellRenderer&&i.push(t)}));var a=function e(t){var i=[];return $.each(t,(function(t,a){if(null!=a.children){var o=a.children;$.each(e(o),(function(e,t){i.push(t)}))}else i.push(a)})),i}(i),o=function(e){var t=[];return c(e,0,t),t}(i);console.log("开始导出任务:"+t);var n=new StringBuilder,r=o.length-1;$.each(o,(function(e,t){var i=t;n.appendLine('<tr style="font-weight:bold;white-space:nowrap;">'),$.each(i,(function(t,i){var a=toNumber(i.rowspan),o=toNumber(i.colspan);r>e&&null==i.children&&(a+=e+1);var l='<td colspan="'+o+'" rowspan="'+a+'"',s=["text-align:center"];"序号"==i.headerName&&s.push("mso-number-format:'@'"),l=(l=l+' style="'+s.join(";")+'"')+">"+i.headerName+"</td>",n.appendLine(l)})),n.appendLine("</tr>")}));var l=0;e.api.forEachNode((function(e,t){var i=e.data;n.append("<tr>"),l++,$.each(a,(function(e,t){var a;a=null==t.field?"":i[t.field]||"","htmlCellRenderer"==t.cellRenderer&&(a=delHtmlTag(a)),"序号"==t.headerName&&(a=l);var o=[];if("number"==t.type){var r=t.numberOptions||{},s=null==r.places?2:r.places;a=parseFloat(a),a=isNaN(a)?0:a.toFixed(s)}else"date"==t.form_type||o.push("mso-number-format:'@'");n.appendLine('<td style="'+o.join(";")+'">'+a+"</td>")})),n.appendLine("</tr>")})),console.log("结束导出任务:"+t);var s='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Sheet1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body><table>'+n.toString(" ")+"</table></body></html>",d=new Date;!function(e,t){var i=document.createElement("a");i.download=t;var a=new Blob([e]);i.href=URL.createObjectURL(a),document.body.appendChild(i),i.click(),document.body.removeChild(i)}(s,t+"-"+[d.getFullYear(),d.getMonth()+1,d.getDate()].join("-")+".xls")}else toastrError("表格无数据，无法导出.");function c(e,t,i){var a=null;i.length>t?a=i[t]:(a=[],i.push(a)),$.each(e,(function(e,o){var n=o.children;null!=n&&(o.colspan=n.length,c(n,t+1,i)),o.rowspan=1,a.push(o)}))}}function LocalTableExport(e,t){var i=$("#"+e),a=!!i.hasClass("table2excel_with_colors"),o=new Date,n=[o.getFullYear(),o.getMonth()+1,o.getDate()].join("-");i.table2excel({exclude:".noExl",name:t,filename:t+n+".xls",fileext:".xls",exclude_img:!0,exclude_links:!0,exclude_inputs:!0,preserveColors:a})}function regionSelect(){var e=arguments,t={a1:"省",a2:"市",a3:"县"};function i(e,t,i,a){$.get(app.url("index/api/region",{layer:t,parent_id:i}),(function(t){var i="";$.map(t,(function(e){i+='<option value="'+e.id+'">'+e.name+"</option>"}));var o=$("#"+e).html(i);a>0&&o.val(a)}))}$("#"+e[0]).on("change",(function(){i(e[1],2,this.value,0),$("#"+e[1]).html('<option value="">'+t.a2+"</option>"),$("#"+e[2]).html('<option value="">'+t.a3+"</option>")})),$("#"+e[1]).on("change",(function(){i(e[2],3,this.value,0),$("#"+e[2]).html('<option value="">'+t.a3+"</option>")})),i(e[0],1,0,e[3]),e[3]&&(i(e[1],2,e[3],e[4]),e[4]&&i(e[2],3,e[4],e[5]))}String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)},StringBuilder.prototype.append=function(e){this._stringArray.push(e)},StringBuilder.prototype.appendLine=function(e){this._stringArray.push(e+"\n")},StringBuilder.prototype.toString=function(e){return this._stringArray.join(e)};
